<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.57 in css mode. -->
<html>
  <head>
    <title>repl-driven-development.org</title>
    <style type="text/css">
    <!--
      body {
        color: #7c6f64;
        background-color: #fbf1c7;
      }
      .bold {
        /* bold */
        font-weight: bold;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #7c6f64;
        font-weight: bold;
      }
      .comment {
        /* font-lock-comment-face */
        color: #a89984;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #a89984;
      }
      .constant {
        /* font-lock-constant-face */
        color: #076678;
        font-weight: bold;
      }
      .custom {
      }
      .custom-1 {
        /* (:foreground "#d0bf8f") */
        color: #d0bf8f;
      }
      .custom-2 {
        /* (:foreground "#dc8cc3") */
        color: #dc8cc3;
      }
      .custom-3 {
        /* (:foreground "#afd8af") */
        color: #afd8af;
      }
      .custom-4 {
      }
      .custom-5 {
      }
      .custom-6 {
        /* (:box "purple" :foreground "purple") */
        color: #a020f0;
      }
      .custom-7 {
        /* (:foreground "#cc9393") */
        color: #cc9393;
      }
      .custom-button {
        /* custom-button */
        color: #665c54;
        background-color: #ebdbb2;
      }
      .doc {
        /* font-lock-doc-face */
        color: #689d6a;
      }
      .flyspell-duplicate {
        /* flyspell-duplicate */
        text-decoration: underline;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #076678;
      }
      .haskell-definition {
        /* haskell-definition-face */
        color: #076678;
      }
      .haskell-operator {
        /* haskell-operator-face */
        color: #076678;
      }
      .hl-todo {
        /* hl-todo */
        color: #cc9393;
        font-weight: bold;
      }
      .italic {
        /* italic */
        font-style: italic;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #98971a;
        font-weight: bold;
      }
      .operator {
      }
      .org-block {
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #a89984;
        font-style: italic;
        text-decoration: underline;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #a89984;
        font-style: italic;
        text-decoration: overline;
      }
      .org-code {
        /* org-code */
        color: #a89984;
      }
      .org-document-info {
        /* org-document-info */
        color: #7c6f64;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #a89984;
      }
      .org-document-title {
        /* org-document-title */
        color: #665c54;
        font-size: 130%;
        font-weight: bold;
      }
      .org-drawer {
        /* org-drawer */
        color: #689d6a;
      }
      .org-hide {
        /* org-hide */
        color: #fbf1c7;
      }
      .org-latex-and-related {
        /* org-latex-and-related */
        color: #8b4513;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #af3a03;
        font-size: 130%;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #98971a;
        font-size: 120%;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #076678;
        font-size: 114%;
      }
      .org-link {
        /* org-link */
        color: #b57614;
        font-weight: bold;
        text-decoration: underline;
      }
      .org-list-dt {
        /* org-list-dt */
        font-weight: bold;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #a89984;
        font-style: italic;
      }
      .org-property-value {
      }
      .org-special-keyword {
        /* org-special-keyword */
        color: #a89984;
        font-weight: bold;
      }
      .org-table {
        /* org-table */
        color: #98971a;
      }
      .org-tag {
        /* org-tag */
        font-weight: bold;
      }
      .org-todo {
        /* org-todo */
        color: #689d6a;
        font-weight: bold;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #a89984;
      }
      .string {
        /* font-lock-string-face */
        color: #689d6a;
      }
      .type {
        /* font-lock-type-face */
        color: #b57614;
      }
      .underline {
        /* underline */
        text-decoration: underline;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #076678;
      }
      .warning {
        /* font-lock-warning-face */
        color: #af3a03;
        font-weight: bold;
      }
      .writegood-duplicates {
        /* writegood-duplicates-face */
        text-decoration: underline;
      }
      .writegood-passive-voice {
        /* writegood-passive-voice-face */
        text-decoration: underline;
      }
      .writegood-weasels {
        /* writegood-weasels-face */
        text-decoration: underline;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="comment"># -*- eval: (my/execute-startup-blocks) -*-</span>
<span class="org-document-info-keyword">#+title:</span> <span class="org-document-title">&#128144; Repl Driven Development and The Wonders of &lt;kbd&gt;C-x C-e&lt;/kbd&gt; &#128257;, or &lt;em&gt;Editor Integrated REPLs for all languages&lt;/em&gt;
</span><span class="org-meta-line">#+description: Press &#8220;C-x C-e&#8221; to send any piece of code (in any language) to a REPL in the background, within Emacs!</span>
<span class="org-meta-line">#+property: header-args:emacs-lisp :tangle yes :exports code :eval never-export</span>
<span class="org-meta-line">#+options: d:nil toc:t</span>
<span class="org-meta-line">#+toc: headlines 2</span>
<span class="org-document-info-keyword">#+author:</span> <span class="org-document-info"><a href="https://www.alhassy.com">Musa Al-hassy</a>
</span><span class="org-document-info-keyword">#+email:</span> <span class="org-document-info">alhassy@gmail.com
</span><span class="org-document-info-keyword">#+date:</span> <span class="org-document-info">&lt;2023-05-23 Tue&gt;
</span><span class="comment"># #+filetags: java python lisp</span>
<span class="org-meta-line">#+fileimage: emacs-birthday-present.png 48% 18%</span>
<span class="org-meta-line">#+filetags: repl-driven-development vscode emacs javascript java python lisp clojure haskell arend purescript idris racket</span>
<span class="comment"># #+fileimage: <a href="https://raw.githubusercontent.com/alhassy/easy-extensibility/main/graphics/repl.gif">https://raw.githubusercontent.com/alhassy/</a></span><span class="comment"><span class="writegood-weasels"><a href="https://raw.githubusercontent.com/alhassy/easy-extensibility/main/graphics/repl.gif">easy</a></span></span><span class="comment"><a href="https://raw.githubusercontent.com/alhassy/easy-extensibility/main/graphics/repl.gif">-extensibility/main/graphics/repl.gif</a> </span><span class="comment"><span class="writegood-duplicates">90% 90%</span></span>

<span class="comment"># (progn (load-file "../AlBasmala.el") (advice-add 'blog/preview :before 'my/ensure-headline-ids))</span>

<span class="comment"># </span><span class="comment"><span class="hl-todo"><span class="custom-7">TODO</span></span></span><span class="comment">: The &#8220;-filter&#8221; method is my callback for when a process emits </span><span class="comment"><span class="writegood-weasels">some</span></span><span class="comment"> output!</span>
<span class="comment"># As such, I can use that to hook my tests! Something to explore when I have the</span>
<span class="comment"># basics of rdd.el fleshed-out.</span>

<span class="org-level-1">* Abstract                                                           </span><span class="org-level-1"><span class="org-tag">:ignore:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Abstract</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Warning|Incomplete_DRAFT|red||codeigniter">badge:Warning|Incomplete_DRAFT|red||codeigniter</a>
</span><span class="org-block-end-line">#+end_center
</span>
The <span class="custom-6"><a href="melpa:repl-driven-development">melpa:repl-driven-development</a></span> package makes the philosophy of REPL Driven
Development (RDD) accessible to any language that has a primitive CLI repl: <span class="italic">The
result is an Emacs interface for the language, where code of your choosing is</span>
<span class="italic">evaluated, and results </span><span class="italic"><span class="writegood-passive-voice">are echoed</span></span><span class="italic"> at your cursor in overlays.</span>

That is, with Repl <span class="bold"><a href="green:aided">green:aided</a></span> development, you make software by starting with
an already working program (i.e., the repl) then <span class="bold"><a href="green:incrementlly">green:incrementlly</a></span> &#8220;teach it&#8221;
to be the program you want, by defining &amp; redefining things.  Until satisfied,
loop: Type/modify code <span class="bold"><a href="green:in your editor">green:in your editor</a></span>, press <span class="writegood-weasels">some</span> keys to evaluate what you
wrote/modified <span class="italic">in the currently running system</span>, and explore/test the resulting
runtime.
<span class="comment"># Eventually, save your code as a clean text file.</span>

<span class="italic">RDD is programming emphasising fast &amp; rich feedback from a running system.</span> RDD
is fantastic for quickly <span class="italic">teaching/exploring</span> an idea; as such, the running
example of this article will be on servers ---no prior experience with servers
<span class="writegood-passive-voice">is assumed</span>.
The main examples will be in JavaScript, Python, and Java.  (Since <span class="italic">JavaScript is
just Lisp in C clothing</span>, we will not discuss Lisp.)  Since Java is verbose, the
power of REPLs really pays off when exploring a new idea. We see how <span class="writegood-weasels">many</span>
imports and setup-code <span class="writegood-weasels">simply</span> disappear in the RDD approach, letting you focus
on the core idea you're exploring/teaching.  For comparison, a traditional
self-contained Java server program is ~30 lines long whereas the focused RDD
approach is ~4 lines long.
<span class="comment">#</span>
<span class="comment"># + We begin with JavaScript: Write </span><span class="comment"><span class="writegood-weasels">some</span></span><span class="comment"> code, and see it interact with your browser.</span>
<span class="comment"># + Then Python: Write </span><span class="comment"><span class="writegood-weasels">some</span></span><span class="comment"> code, and see it interact with the terminal.</span>

<span class="comment"># <a href="badge:repl-driven-development|1.4|informational|https://github.com/alhassy/repl-driven-development|Gnu-Emacs">badge:repl-driven-development|1.4|informational|https://github.com/alhassy/repl-driven-development|Gnu-Emacs</a></span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:license|GNU_3|informational|https://www.gnu.org/licenses/gpl-3.0.en.html|read-the-docs">badge:license|GNU_3|informational|https://www.gnu.org/licenses/gpl-3.0.en.html|read-the-docs</a>
<a href="tweet:https://alhassy.com/repl-driven-development">tweet:https://alhassy.com/repl-driven-development</a>
<a href="badge:|buy_me_a_coffee|gray|https://www.buymeacoffee.com/alhassy|buy-me-a-coffee">badge:|buy_me_a_coffee|gray|https://www.buymeacoffee.com/alhassy|buy-me-a-coffee</a>
</span><span class="org-block"><span class="comment">@@</span></span><span class="org-block"><span class="org-tag"><span class="hl-todo"><span class="custom-7"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span></span></span><span class="org-block"><span class="org-tag">:</span></span><span class="org-block"> FIX contributions URL</span><span class="org-block"><span class="comment">@@</span></span><span class="org-block">
<a href="badge:contributions|welcome|green|https://github.com/alhassy/alhassy.github.io/issues">badge:contributions|welcome|green|https://github.com/alhassy/alhassy.github.io/issues</a>
<a href="badge:Warning|Incomplete_DRAFT|red||codeigniter">badge:Warning|Incomplete_DRAFT|red||codeigniter</a>
</span><span class="org-block-end-line">#+end_center
</span>
<span class="comment"># @@html: &lt;br&gt; @@</span>

<span class="italic">tdlr:</span> This library provides the Emacs built-in <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> behaviour for
arbitrary languages, provided they have a primitive cli <span class="flyspell-duplicate">REPL</span>.

<span class="org-level-1">* A Rapid Overview of </span><span class="org-level-1"><span class="flyspell-duplicate">RDD</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">A-Rapid-Overview-of-RDD</span>
<span class="org-drawer">:END:</span>
<span class="org-hide">*</span><span class="org-level-2">* How do people usually code? &#127780;&#65039;</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">How-do-people-usually-code-&#65039;</span>
<span class="org-drawer">:END:</span>

Either you,

1. Use a code editor and edit multiple lines, then jump into a console to try
   out what you wrote&#9203;, or

2. You use an interactive command line, and work with one line at a time
   ---continuously editing &amp; evaluating &#128260;

The first approach sucks because your code and its resulting behaviour occur in
different places &#128546; The second is only realistic for small experimentation
---after all, you're in a constrained environment and don't generally have the
same features that your code editor provides &#129503;&#8205;&#9794;&#65039;

<span class="org-hide">*</span><span class="org-level-2">* If only we could have our cake, and eat it too! &#127856;</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">If-only-we-could-have-our-cake-and-eat-it-too</span>
<span class="org-drawer">:END:</span>

With an <span class="italic">editor-integrated REPL</span>, we get both approaches! No need to switch
between the two any more! For example, Emacs out-of-the-box lets us just select
<span class="writegood-weasels">some</span> code and press <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> ---<span class="italic">E for Evaluate!</span> &#128521;

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Press &#8220;control and x, then control and e&#8221;, at the end of the line, to run the following code
</span></span><span class="org-block">(message-box </span><span class="org-block"><span class="string">"hello world"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
The <span class="custom-6"><a href="melpa:repl-driven-development">melpa:repl-driven-development</a></span> software gives us this feature <span class="italic">for any
language</span>! For example, Press <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> at the end of the following line to get
an Emacs-integrated REPL for Java ---i.e.,
<span class="custom-5"><a href="kbd:C-x_C-j">kbd:C-x_C-j</a></span> will now
evaluate a selection, or the entire line, as if it were Java code.
- Why <span class="custom-5"><a href="kbd:C-x_C-j">kbd:C-x_C-j</a></span> &#160;?&#160; Well, <span class="custom-4"><a href="kbd:C-x_C-&#8220;e">kbd:C-x_C-&#8220;e</a></span>&#8221; for Emacs Lisp code, and <span class="custom-4"><a href="kbd:C-x_C-&#8220;j">kbd:C-x_C-&#8220;j</a></span>&#8221;
  for Java code!
<span class="comment"># - For instance, copy-paste the following examples into a Java file ---or just</span>
<span class="comment">#  press <a href="kbd:C-x_C-j">kbd:C-x_C-j</a> /in any buffer/ to evaluate them!</span>

<span class="comment"># Get &#8220;<a href="kbd:C-x_C-j">kbd:C-x_C-j</a>&#8221; defined for HTML export.</span>
<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-j now evaluates arbitrary Java code
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">&#10214;Emacs spawns a new &#8220;jshell&#8221; process, then &#8220;C-x C-j&#8221; sends text to that process.&#10215;
</span></span><span class="org-block">  (repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"jshell"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"jshell&gt;"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
We can now press <span class="custom-5"><a href="kbd:C-x_C-j">kbd:C-x_C-j</a></span> to execute any Java code, and see results echoed inline in an overlay, such as:
<span class="org-block-begin-line">#+begin_src java :tangle nil
</span><span class="org-block">  1 + 2                     </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; 3
</span></span><span class="org-block">  System.out.println(2 + 3) </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; 5
</span></span><span class="org-block">  </span><span class="org-block"><span class="string">"hello"</span></span><span class="org-block">[0]                </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#128683; Type error: Java strings are not arrays
</span></span><span class="org-block">
  IntStream.range(0, 100).toArray() </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">A multi-line overlay of numbers 0..99
</span></span><span class="org-block">
  </span><span class="org-block"><span class="keyword">import</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">javax</span></span><span class="org-block">.</span><span class="org-block"><span class="constant">swing</span></span><span class="org-block">.*;     </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">(No output; this is an effectful operation)
</span></span><span class="org-block">
  </span><span class="org-block"><span class="type">var</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">frame</span></span><span class="org-block"> = </span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">JFrame</span></span><span class="org-block">(){{ setAlwaysOnTop(</span><span class="org-block"><span class="constant">true</span></span><span class="org-block">); }};  </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; &#8216;frame&#8217; </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is defined</span></span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">
  JOptionPane.showMessageDialog(frame, </span><span class="org-block"><span class="string">"Super nice!"</span></span><span class="org-block">);  </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; A GUI appears &#128157;
</span></span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+html: &lt;center&gt;</span>
&#128064;
<span class="italic">This extension is an </span><span class="italic"><span class="writegood-weasels">easy</span></span><span class="italic"> Emacs-integrated-REPL builder for any language!</span>
&#128562;
<span class="org-meta-line">#+html: &lt;/center&gt;</span>

Learn more Java from
<a href="badge:Java|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.com/java-cheat-sheet.pdf|coffeescript">badge:Java|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.com/java-cheat-sheet.pdf|coffeescript</a>
.

<span class="comment"># Moreover, there is an =*REPL/python3 -i*= buffer created for your REPL so you can</span>
<span class="comment"># see everything you've sent to it, and the output it sent back.  This is</span>
<span class="comment"># particularly useful for lengthy error messages, such as those of Java, which</span>
<span class="comment"># cannot </span><span class="comment"><span class="writegood-passive-voice">be rendered</span></span><span class="comment"> nicely within an overlay.</span>

<span class="org-hide">*</span><span class="org-level-2">* Say that again, but use Python please! &#128013; </span><span class="org-level-2"><span class="org-tag">:details:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Say-that-again-but-use-Python-please</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Python|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/PythonCheatSheet/CheatSheet.pdf|python">badge:Python|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/PythonCheatSheet/CheatSheet.pdf|python</a>
</span><span class="org-block-end-line">#+end_center
</span>
With an <span class="italic">editor-integrated REPL</span>, we get both approaches! No need to switch
between the two any more! For example, Emacs out-of-the-box lets us just select
<span class="writegood-weasels">some</span> code and press <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> ---<span class="italic">E for Evaluate!</span> &#128521;

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Press &#8220;control and x, then control and e&#8221; to run the following code
</span></span><span class="org-block">(message-box </span><span class="org-block"><span class="string">"hello world"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
The <span class="custom-6"><a href="melpa:repl-driven-development">melpa:repl-driven-development</a></span> software gives us this feature <span class="italic">for any
language</span>! For example, Press <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> on the following line to get
an Emacs-integrated REPL for Python:
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-p now evaluates arbitrary Python code
</span></span><span class="org-block">    (repl-driven-development [C-x C-p] </span><span class="org-block"><span class="string">"python3"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
We can now press <span class="custom-5"><a href="kbd:C-x_C-p">kbd:C-x_C-p</a></span> to execute any Python code, such as:
<span class="org-block-begin-line">#+begin_src python
</span><span class="org-block"><span class="keyword">import</span></span><span class="org-block"> os                       </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#8658; Module OS imported
</span></span><span class="org-block">f</span><span class="org-block"><span class="string">"Hello, </span></span><span class="org-block">{os.environ['USER']}</span><span class="org-block"><span class="string">!"</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#8658; &#8220;Hello, musa!&#8221;
</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
More exciting fun is to produce an increasing family of colourful circles, in a GUI:
<span class="org-block-begin-line">#+begin_src python
</span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">Ensure we have </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="comment"> GUI capabilities installed; press &#8220;C-x C-e&#8221;:
</span></span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">(async-shell-command "brew install python-tk")
</span></span><span class="org-block">
</span><span class="org-block"><span class="keyword">import</span></span><span class="org-block"> turtle
</span><span class="org-block"><span class="variable-name">it</span></span><span class="org-block"> </span><span class="org-block"><span class="operator">=</span></span><span class="org-block"> turtle.Turtle()  </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">This opens a new window
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">The following fragment was &#8220;discovered&#8221; by trying things out repeatedly with &#8220;C-x C-p&#8221;.
</span></span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"> i </span><span class="org-block"><span class="keyword">in</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">range</span></span><span class="org-block">(10):
    it.pencolor(</span><span class="org-block"><span class="string">"green"</span></span><span class="org-block"> </span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> i </span><span class="org-block"><span class="operator">%</span></span><span class="org-block"> 2 </span><span class="org-block"><span class="operator">==</span></span><span class="org-block"> 0 </span><span class="org-block"><span class="keyword">else</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"red"</span></span><span class="org-block">)
    it.pensize(i </span><span class="org-block"><span class="operator">/</span></span><span class="org-block"> 2)
    it.circle(i </span><span class="org-block"><span class="operator">*</span></span><span class="org-block"> 10)


</span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">Note for Python, the above &#8220;for&#8221; loop is &#8220;complete&#8221; if we also send the extra
</span></span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">newline after it.
</span></span><span class="org-block-end-line">#+end_src
</span>Learn more with <span class="org-link"><a href="https://realpython.com/beginners-guide-python-turtle/">The Beginner's Guide to Python Turtle</a></span>.

<span class="hl-todo"><span class="custom-7">TODO</span></span>: Make this into a Gif, that incrementlly shows the turtle appearing?
ie it starts off with an experiment of the loop body, then it wraps it
in the for, then re-runs and all of this is <span class="underline">discovered live</span>!


&#128064;
<span class="italic">This extension is an </span><span class="italic"><span class="writegood-weasels">easy</span></span><span class="italic"> Emacs-integrated-REPL builder for any language!</span>
&#128562;

<span class="org-hide">*</span><span class="org-level-2">* Technically speaking, how is Emacs </span><span class="org-level-2"><span class="italic">itself</span></span><span class="org-level-2"> the </span><span class="org-level-2"><span class="flyspell-duplicate">REPL</span></span><span class="org-level-2">? &#129300;</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Technically-speaking-how-is-Emacs-itself-the-REPL</span>
<span class="org-drawer">:END:</span>

Let's do what math-nerds call <span class="italic">proof by definition-chasing:</span>

1. Definition: REPL is <span class="italic">any software</span> that supports a Read-Evaluate-Print-Loop cycle.

2. <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> / <span class="custom-5"><a href="kbd:C-x_C-j">kbd:C-x_C-j</a></span> will echo the results next to your cursor, in your
   editor

3. So it retains each of the read, eval, and print parts of the Read-Evaluate-Print-Loop

4. Moreover, since the program doesn't terminate, you're still in the <span class="italic">loop part</span>
   until you close Emacs

<span class="org-hide">*</span><span class="org-level-2">* &#128727; Summarising Evaluator Pitch &#9918;</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Summarising-Evaluator-Pitch</span>
<span class="org-drawer">:END:</span>

<span class="org-meta-line">#+html: &lt;center&gt;</span>
<span class="italic">Make Emacs itself a REPL for your given language of choice</span>
<span class="org-meta-line">#+html: &lt;/center&gt;</span>

Suppose you're exploring a Python/Ruby/Java/JS/TS/Haskell/Lisps/etc
API, or experimenting with an idea and want immediate feedback.
You could open a terminal and try things out there; with no editor
support, and occasionally copy-pasting things back into your editor
for future use. Better yet, why not use your editor itself as a REPL.

The <span class="custom-6"><a href="melpa:repl-driven-development">melpa:repl-driven-development</a></span> software provides the Emacs built-in
<span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> behaviour for arbitrary languages, provided they have a primitive
cli REPL.

<span class="org-meta-line">#+html: &lt;center&gt;</span>
<span class="bold">Benefits</span>
<span class="org-meta-line">#+html: &lt;/center&gt;</span>

Whenever reading/refactoring <span class="writegood-weasels">some</span> code, if you can make <span class="writegood-weasels">some</span> of it
self-contained, then you can immediately try it out! No need to
load your entrie program; nor copy-paste into an external REPL. The
benefits of Emacs' built-in &#8220;C-x C-e&#8221; for Lisp, and Lisp's Repl
Driven Development philosophy, are essentially made possible for
arbitrary languages (to <span class="writegood-weasels">some</span> approximate degree, but not fully).

Just as &#8220;C-u C-x C-e&#8221; inserts the resulting expression at the
current cursour position, so too all repl-driven-development
commands allow for a C-u prefix which inserts the result.
This allows for a nice scripting experience where results
<span class="writegood-passive-voice">are kept</span> for future use ---e.g., when writing unit tests where you have an
expression but do not know what it results to.

<span class="org-hide">*</span><span class="org-level-2">* &#129302; &#128170; &#129302; Features of RDD.</span><span class="org-level-2"><span class="flyspell-duplicate">el</span></span><span class="org-level-2"> &#128170; &#129302; &#128170;</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Features-of-RDD-el</span>
<span class="org-drawer">:END:</span>

+ &#128064; Evaluation results <span class="writegood-passive-voice">are echoed</span> at your cursor, in your editor, by your code, in an overlay
+ &#128273; You can specify whatever keys you want, for evaluating code.  That
  keybinding is itself well-documented, just invoke <span class="custom-5"><a href="kbd:C-h_k">kbd:C-h_k</a></span> then your
  keybinding.
+ &#129657; Press <span class="custom-4"><a href="kbd:C-u_C-x_C-j">kbd:C-u_C-x_C-j</a></span> to get the results of your evaluated expression
  printed inline, at your cursor.
+ &#128218; Documentation <span class="writegood-passive-voice">is supported</span> out of the box: Put the cursor over a function
  name (like "print" or "error"). Then press <span class="custom-4"><a href="kbd:C-u_C-u_C-x_C-j">kbd:C-u_C-u_C-x_C-j</a></span> and you get the
  documentation of that function.
<span class="comment"># + </span><span class="comment"><span class="hl-todo"><span class="custom-7">TODO</span></span></span><span class="comment">: More coming!</span>
<span class="comment"># + &#8942;</span>
<span class="comment"># + &#128640;</span>

<span class="org-level-1">* Implementation of </span><span class="org-level-1"><span class="custom-button"><a href="doc:repl-driven-development">doc:repl-driven-developmen</a><a href="doc:repl-driven-development">t</a></span></span><span class="org-level-1"> </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Implementation-of-doc-repl-driven-development</span>
<span class="org-drawer">:END:</span>

This article does <span class="italic">not</span> discuss the source code, which can <span class="writegood-passive-voice">be found</span> below, folded
away. If you're interested, consider consulting
<a href="badge:Elisp|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/ElispCheatSheet/CheatSheet.pdf|Gnu-Emacs">badge:Elisp|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/ElispCheatSheet/CheatSheet.pdf|Gnu-Emacs</a>.
<span class="org-hide">*</span><span class="org-level-2">* Lisp Package Preamble                           </span><span class="org-level-2"><span class="org-tag">:details_package_preamble:</span></span>
  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Preamble</span>
  <span class="org-drawer">:END:</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block"><span class="comment-delimiter">;;; </span></span><span class="org-block"><span class="comment">repl-driven-development.el --- Send arbitrary code to a REPL in the background  -*- lexical-binding: t; -*-
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Copyright (c) 2023 Musa Al-hassy
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Author: Musa Al-hassy <a href="mailto:alhassy%40gmail.com">&lt;alhassy@gmail.com&gt;</a>
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Version: 1.0.1
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Package-Requires: ((s "1.12.0") (dash "2.16.0") (eros "0.1.0") (bind-key "2.4.1") (emacs "27.1") (f "0.20.0") (devdocs "0.5") (pulsar "1.0.1"))
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Keywords: repl-driven-development, rdd, repl, lisp, java, python, ruby, programming, convenience
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Repo: <a href="https://github.com/alhassy/repl-driven-development">https://github.com/alhassy/repl-driven-development</a>
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Homepage: <a href="http://alhassy.com/repl-driven-development">http://alhassy.com/repl-driven-development</a>
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This program is free software; you can redistribute it and/or modify
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">it under the terms of the GNU General Public License as published by
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">the Free Software Foundation, either version 3 of the License, or
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(at your option) any later version.
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This program </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is distributed</span></span></span><span class="org-block"><span class="comment"> in the hope that it will be useful,
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">GNU General Public License for more details.
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">You should have received a copy of the GNU General Public License
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;;; </span></span><span class="org-block"><span class="comment">Commentary:
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This library provides the Emacs built-in &#8220;C-x C-e&#8221; behaviour for
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">arbitrary languages, provided they have a REPL shell command.
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Minimal Working Example [Java]:
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">;; Set &#8220;C-x C-j&#8221; to evaluate Java code in a background REPL.
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">(repl-driven-development [C-x C-j] "jshell" :prompt "jshell&gt;")
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">// Select this Java snippet, then press &#8220;C-x C-j&#8221; to evaluate it
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">import javax.swing.*;
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">var frame = new JFrame(){{ setAlwaysOnTop(true); }};
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">JOptionPane.showMessageDialog(frame, "Super nice!");
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">// REPL result values </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">are shown</span></span></span><span class="org-block"><span class="comment"> as overlays:
</span></span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">2 + 4 // &#8658; 6
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Benefits:
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Whenever reading/refactoring </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="comment"> code, if you can make </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="comment"> of it
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">self-contained, then you can immediately try it out! No need to
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">load your entire program; nor copy-paste into an external REPL. The
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">benefits of Emacs' built-in &#8220;C-x C-e&#8221; for Lisp, and Lisp's Repl
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Driven Development philosophy, are essentially made possible for
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">arbitrary languages (to </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="comment"> approximate degree, but not fully).
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Just as &#8220;C-u C-x C-e&#8221; inserts the resulting expression at the
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">current cursour position, so too all repl-driven-development
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">commands allow for a C-u prefix which inserts the result.
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This allows for a nice scripting experience where results
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">are kept</span></span></span><span class="org-block"><span class="comment"> for future use.
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This file has </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">been tangled</span></span></span><span class="org-block"><span class="comment"> from a literate, org-mode, file.
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;;; </span></span><span class="org-block"><span class="comment">Code:
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">String and list manipulation libraries
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><a href="https://github.com/magnars/dash.el">https://github.com/magnars/dash.el</a>
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><a href="https://github.com/magnars/s.el">https://github.com/magnars/s.el</a>
</span></span><span class="org-block">
(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">s</span></span><span class="org-block">)               </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">&#8220;The long lost Emacs string manipulation library&#8221;
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">dash</span></span><span class="org-block">)            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">&#8220;A modern list library for Emacs&#8221;
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">cl-lib</span></span><span class="org-block">)          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">New Common Lisp library; &#8216;</span></span><span class="org-block"><span class="comment"><span class="constant">cl-???</span></span></span><span class="org-block"><span class="comment">&#8217; forms.
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">eros</span></span><span class="org-block">)            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">Simple</span></span></span><span class="org-block"><span class="comment"> Emacs Overlays
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">org</span></span><span class="org-block">)
(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">bind-key</span></span><span class="org-block">)

(</span><span class="org-block"><span class="keyword">defconst</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">repl-driven-development-version</span></span><span class="org-block"> (package-get-version))
(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">repl-driven-development-version</span></span><span class="org-block"> ()
  </span><span class="org-block"><span class="doc">"Print the current repl-driven-development version in the minibuffer."</span></span><span class="org-block">
  (</span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block">)
  (message repl-driven-development-version))
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-meta-line">#+RESULTS:</span>
<span class="org-code">: repl-driven-development-version
</span>
<span class="org-hide">*</span><span class="org-level-2">* Implementation Code                            </span><span class="org-level-2"><span class="org-tag">:details_source_code:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Implementation-Code</span>
<span class="org-drawer">:END:</span>

<span class="comment"># (repl-driven-development [C-x C-j] "node")</span>
<span class="comment"># (repl-driven-development [C-x C-j] "jshell" :prompt "jshell&gt;")</span>

<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp  :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">rdd---current-input</span></span><span class="org-block"> nil
  </span><span class="org-block"><span class="doc">"Used to avoid scenarios where input </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">is echoed</span></span></span><span class="org-block"><span class="doc"> thereby accidentally treating it as a repl output."</span></span><span class="org-block">)

(</span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">rdd---current-output</span></span><span class="org-block"> nil
  </span><span class="org-block"><span class="doc">"The output of the most recent repl call; this </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">is used</span></span></span><span class="org-block"><span class="doc"> for testing."</span></span><span class="org-block">)

  </span><span class="org-block"><span class="comment-delimiter">;;;</span></span><span class="org-block"><span class="comment">###autoload
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">cl-defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">repl-driven-development</span></span><span class="org-block"> (keys cli </span><span class="org-block"><span class="type">&amp;key</span></span><span class="org-block"> (prompt </span><span class="org-block"><span class="string">"&gt;"</span></span><span class="org-block">) docs (prologue </span><span class="org-block"><span class="string">""</span></span><span class="org-block">))
    </span><span class="org-block"><span class="doc">"Make Emacs itself a REPL for your given language of choice.

  Suppose you're exploring a Python/Ruby/Java/JS/TS/Haskell/Lisps/etc
  API, or experimenting with an idea and want immediate feedback.
  You could open a terminal and try things out there; with no editor
  support, and occasionally copy-pasting things back into your editor
  for future use. Better yet, why not use your editor itself as a REPL.

  Implementation &amp; behavioural notes can </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">be found</span></span></span><span class="org-block"><span class="doc"> in the JavaScript
  Example below.

  ######################################################################
  ### JavaScript Example ---Basic usage, and a minimal server ##########
  ######################################################################

     ;; C-x C-j now evaluates arbitrary JavaScript code
     (repl-driven-development [C-x C-j] \"node\")

  That's it! Press &#8220;C-x C-e&#8221; on the above line so that &#8220;C-x C-j&#8221;
  will now evaluate a selection, or the entire line, as if it were
  JavaScript code. &#10214;Why C-x C-j? C-x C-&#8220;e&#8221; for Emacs Lisp code, and C-x
  C-&#8220;j&#8221; for JavaScript code!&#10215; For instance, copy-paste the
  following examples into a JS file ---or just press &#8220;C-x C-j&#8221; to
  evaluate them!

      1 + 2                                     // &#11157; 3
      1 + '</span></span><span class="org-block"><span class="doc"><span class="constant">2</span></span></span><span class="org-block"><span class="doc">'                                   // &#11157; '</span></span><span class="org-block"><span class="doc"><span class="constant">12</span></span></span><span class="org-block"><span class="doc">'
      let me = {name: '</span></span><span class="org-block"><span class="doc"><span class="constant">Jasim</span></span></span><span class="org-block"><span class="doc">'}; Object.keys(me) // &#11157; ['</span></span><span class="org-block"><span class="doc"><span class="constant">name</span></span></span><span class="org-block"><span class="doc">']
      me.doesNotExist('</span></span><span class="org-block"><span class="doc"><span class="constant">whoops</span></span></span><span class="org-block"><span class="doc">')                 // &#11157; Uncaught TypeError
      [ ...Array(45).keys() ]          // &#11157; Multi-line overlay of 0..44

  All of these results </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">are echoed</span></span></span><span class="org-block"><span class="doc"> inline in an overlay, by default.
  Moreover, there is a *REPL* buffer created for your REPL so you
  can see everything you've sent to it, and the output it sent
  back.  This is particularly useful for lengthy error messages,
  such as those of Java, which cannot </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">be rendered</span></span></span><span class="org-block"><span class="doc"> nicely within an
  overlay.

  How this works is that Emacs spawns a new &#8220;node&#8221; process, then
  C-x C-j sends text to that process. Whenever the process emits
  any output ---on stdout or stderr--- then we emit that to the
  user via an overlay.

  Finally, &#8220;C-h k  C-x C-j&#8221; will show you the name of the function
  that </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">is invoked</span></span></span><span class="org-block"><span class="doc"> when you press C-x C-j, along with minimal docs.

  A useful example would be a minimal server, and requests for it.

     // First get stuff with C-x C-e:
     // (async-shell-command \"npm install -g express axios\")

     let app = require('</span></span><span class="org-block"><span class="doc"><span class="constant">express</span></span></span><span class="org-block"><span class="doc">')()
     let clicked = 1
     app.get('</span></span><span class="org-block"><span class="doc"><span class="constant">/hi</span></span></span><span class="org-block"><span class="doc">', (req, res) =&gt; res.send(`Hello World &#215; ${clicked++}`))

     let server = app.listen(3000)
     // Now visit   <a href="http://localhost:3000/hi">http://localhost:3000/hi</a>   a bunch of times!

    // Better yet, see the output programmatically...
    let axios = require('</span></span><span class="org-block"><span class="doc"><span class="constant">axios</span></span></span><span class="org-block"><span class="doc">')
    // Press C-x C-j a bunch of times on the following expression &#9829;&#8255;&#9829;
    console.log((await axios.get('</span></span><span class="org-block"><span class="doc"><span class="constant">http://localhost:3000/hi</span></span></span><span class="org-block"><span class="doc">')).data)

    // Consider closing the server when you're done with it.
    server.close()

  Just as &#8220;Emacs is a Lisp Machine&#8221;, one can use &#8220;VSCodeJS&#8221; to use
  &#8220;VSCode as a JS Machine&#8221;.
  See <a href="http://alhassy.com/vscode-is-itself-a-javascript-repl">http://alhassy.com/vscode-is-itself-a-javascript-repl</a>.

  ######################################################################
  ### Description of Arguments #########################################
  ######################################################################

  - KEYS [Vector]: A vector such as [C-x C-p] that declares the keybindings for
    the new REPL evaluator.

  - CLI [String]: A string denoting the terminal command to start your repl;
    you may need an &#8220;-i&#8221; flag to force it to be interactive even though
    we use it from a child process rather than a top-level shell.

  - PROMPT [Regular Expression]:
    What is the prompt that your REPL shows, e.g., &#8220;&gt;&#8221;.
    We try to ignore showing it in an overlay that would otherwise hide
    useful output.

  - DOCS [String]: A space-seperated string denoting a list of language documents
    you'd like to associate with your repl.
    Invoking your repl with &#8220;C-u C-u&#8221; will show the documentation
    of the word at point. This </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">is done</span></span></span><span class="org-block"><span class="doc"> using `</span></span><span class="org-block"><span class="doc"><span class="constant">devdocs</span></span></span><span class="org-block"><span class="doc">'.

    For example,
      (repl-driven-development [C-x C-j] \"node\" :docs \"javascript express\")
    Would allow us to invoke &#8220;C-u C-u C-x C-j&#8221; with the cursor on the
    word, say, &#8220;listen&#8221; and we'll see </span></span><span class="org-block"><span class="doc"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="doc"> useful docs (along with
    example uses) of this Express library method &#8220;listen&#8221;.

    Visit <a href="https://devdocs.io/">https://devdocs.io/</a> to see the list of documented languages
    and libraries.

  - PROLOGUE [String | List&lt;String&gt;]: Any initial code you'd like your
    repl to </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">be initiated</span></span></span><span class="org-block"><span class="doc"> with. For example, imports of standard libraries
    is </span></span><span class="org-block"><span class="doc"><span class="writegood-weasels">probably</span></span></span><span class="org-block"><span class="doc"> something you'd always like to have on-hand; or perhaps
    </span></span><span class="org-block"><span class="doc"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="doc"> useful variables/declarations/functions.

  Finally, you may register callbacks via `</span></span><span class="org-block"><span class="doc"><span class="constant">repl-driven-development-output-hook</span></span></span><span class="org-block"><span class="doc">'.

  ### Misc Remarks #####################################################
  VSCode has a similar utility for making in-editor REPLs, by the
  same author: <a href="http://alhassy.com/making-vscode-itself-a-java-repl">http://alhassy.com/making-vscode-itself-a-java-repl</a>
  "</span></span><span class="org-block">
    (</span><span class="org-block"><span class="warning">cl-assert</span></span><span class="org-block"> (</span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> (stringp prologue) (listp prologue)))
    (</span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> (listp prologue) (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> prologue (s-join </span><span class="org-block"><span class="string">"\n"</span></span><span class="org-block"> prologue)))
    (</span><span class="org-block"><span class="warning">cl-assert</span></span><span class="org-block"> (stringp prologue))
    (</span><span class="org-block"><span class="keyword">-let*</span></span><span class="org-block"> (((cmd . args) (s-split </span><span class="org-block"><span class="string">" "</span></span><span class="org-block"> cli))
            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Identifier "repl-driven-development" </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is made</span></span></span><span class="org-block"><span class="comment"> unique
</span></span><span class="org-block">            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">by start-process.
</span></span><span class="org-block">            (repl (apply #'start-process </span><span class="org-block"><span class="string">"repl-driven-development"</span></span><span class="org-block">
                         (format </span><span class="org-block"><span class="string">"*REPL/%s*"</span></span><span class="org-block"> cli) cmd args)))

      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><a href="https://stackoverflow.com/q/4120054">https://stackoverflow.com/q/4120054</a>
</span></span><span class="org-block">      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(set-process-coding-system repl 'unix)
</span></span><span class="org-block">      (</span><span class="org-block"><span class="keyword">with-current-buffer</span></span><span class="org-block">  (format </span><span class="org-block"><span class="string">"*REPL/%s*"</span></span><span class="org-block"> cli)
        (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> buffer-display-table (make-display-table))
        (aset buffer-display-table ?\^M [])
        (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> buffer-read-only t))

     (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> docs (rdd---install-any-not-yet-installed-</span><span class="org-block"><span class="writegood-duplicates">docs docs</span></span><span class="org-block">))
     (eval `(</span><span class="org-block"><span class="keyword">rdd---make-repl-function</span></span><span class="org-block"> ,repl ,keys ,cmd ,docs
         (repl-driven-development ,keys ,cli </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> ,prompt </span><span class="org-block"><span class="builtin">:docs</span></span><span class="org-block"> ,(s-join </span><span class="org-block"><span class="string">" "</span></span><span class="org-block"> docs) </span><span class="org-block"><span class="builtin">:prologue</span></span><span class="org-block"> ,prologue)))

     (process-send-string repl prologue)
     (process-send-string repl </span><span class="org-block"><span class="string">"\n"</span></span><span class="org-block">)

     </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Callback: Write the actual output to the REPL buffer and emit overlay.
</span></span><span class="org-block">     (set-process-filter repl (rdd---main-callback prompt))

     </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Return the REPL process to the user.
</span></span><span class="org-block">     repl))

</span><span class="org-block"><span class="comment-delimiter">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">
(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---main-callback</span></span><span class="org-block"> (prompt)
 `(</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> (process output)

           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">The *REPL* buffer shows things exactly as they'd look like
</span></span><span class="org-block">           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">in a standard interaction in the terminal.
</span></span><span class="org-block">           (rdd---insertion-filter process output)

           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is done</span></span></span><span class="org-block"><span class="comment"> to provide a richer, friendlier, interaction.
</span></span><span class="org-block">           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">^M at the end of line in Emacs is indicating a carriage return (\r) followed by a line feed (\n).
</span></span><span class="org-block">           (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> output (s-trim (s-replace-regexp ,prompt </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> (s-replace </span><span class="org-block"><span class="string">"\r\n"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> output))))

           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">thread `</span></span><span class="org-block"><span class="comment"><span class="constant">output</span></span></span><span class="org-block"><span class="comment">' through output hooks
</span></span><span class="org-block">           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">i.e., run all hooks on REPL output, each possibly modifying output
</span></span><span class="org-block">           (</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">cl</span></span><span class="org-block">)
           (</span><span class="org-block"><span class="keyword">cl-loop</span></span><span class="org-block"> for fun in repl-driven-development/output-hook
                    do (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> output (funcall fun output)))

           (rdd---insert-or-echo output)))

(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---install-any-not-yet-installed-docs</span></span><span class="org-block"> (docs)
  </span><span class="org-block"><span class="doc">"Install any not-yet-installed docs; returns a List&lt;String&gt; of the intalled docs."</span></span><span class="org-block">
  (</span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> docs
    (</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">devdocs</span></span><span class="org-block">)
    (</span><span class="org-block"><span class="warning">cl-assert</span></span><span class="org-block"> (stringp docs))
    (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> docs (</span><span class="org-block"><span class="keyword">--reject</span></span><span class="org-block"> (s-blank? it) (s-split </span><span class="org-block"><span class="string">" "</span></span><span class="org-block"> docs)))
    (</span><span class="org-block"><span class="warning">cl-assert</span></span><span class="org-block"> (listp docs))
    (</span><span class="org-block"><span class="keyword">-let</span></span><span class="org-block"> [installed (mapcar #'f-base (f-entries devdocs-data-dir))]
      (</span><span class="org-block"><span class="keyword">--map</span></span><span class="org-block"> (</span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> (member it installed) (devdocs-install (list (cons 'slug it)))) docs))
    docs))

(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---insert-or-echo</span></span><span class="org-block"> (output)
  </span><span class="org-block"><span class="doc">"If there's a C-u, then insert the output; else echo it in overlay"</span></span><span class="org-block">
  (</span><span class="org-block"><span class="warning">cl-assert</span></span><span class="org-block"> (stringp output))
  (</span><span class="org-block"><span class="keyword">pcase</span></span><span class="org-block"> current-prefix-arg
    ('(4) (</span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> (equal output (s-trim rdd---current-input)) (insert </span><span class="org-block"><span class="string">" "</span></span><span class="org-block"> output)))
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">All other prefixes </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">are handled</span></span></span><span class="org-block"><span class="comment"> by repl-fun-name, above.
</span></span><span class="org-block">    (_
     </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Show output as an overlay at the current cursor position
</span></span><span class="org-block">     </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">&#64830; Since eros </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is intended</span></span></span><span class="org-block"><span class="comment"> to </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">be used</span></span></span><span class="org-block"><span class="comment"> with ELisp, not arbitrary langs,
</span></span><span class="org-block">     </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">it does </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="comment"> sexp look-about, which may not mix well with, say, JS
</span></span><span class="org-block">     </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">arrow functions, so we freeze such movements, locally. &#64831;
</span></span><span class="org-block">     (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> output (rdd---ignore-ansi-color-codes output))
     (</span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> (s-blank? (s-trim output))
       (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> repl-driven-development-current--</span><span class="org-block"><span class="writegood-duplicates">output output</span></span><span class="org-block">)
       (thread-yield)
       (</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">eros</span></span><span class="org-block">)
       (</span><span class="org-block"><span class="keyword">cl-letf</span></span><span class="org-block"> (((symbol-function 'backward-sexp) (</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> (</span><span class="org-block"><span class="type">&amp;rest</span></span><span class="org-block"> _) 0)))
         (eros--make-result-overlay output
           </span><span class="org-block"><span class="builtin">:format</span></span><span class="org-block">  </span><span class="org-block"><span class="string">" &#11157; %s"</span></span><span class="org-block">
           </span><span class="org-block"><span class="builtin">:duration</span></span><span class="org-block"> repl-driven-development/echo-duration)))))
  )
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+RESULTS: startup-code</span>
<span class="org-code">: repl-driven-development/echo-duration
</span>
<span class="org-hide">**</span><span class="org-level-3">* repl-driven-development--make-repl-function and other helpers</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">repl-driven-development-make-repl-function-and-other-helpers</span>
<span class="org-drawer">:END:</span>

<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">repl-driven-development--insert-into-repl-buffer</span></span><span class="org-block"> t)

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(fmakunbound #'repl-driven-development--make-repl-function)
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">defmacro</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---make-repl-function</span></span><span class="org-block"> (repl keys cmd docs incantation-to-restart-repl)
 </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">cl-defmethod repl-driven-development--make-repl-function ((repl process) (cli string) (repl-fun-name string) (docs list))
</span></span><span class="org-block">  </span><span class="org-block"><span class="doc">"Constructs code denoting a function that sends a region to a REPL process"</span></span><span class="org-block">
  (</span><span class="org-block"><span class="keyword">-let*</span></span><span class="org-block"> ((repl-fun-name (intern (concat </span><span class="org-block"><span class="string">"repl/"</span></span><span class="org-block"> cmd))))
      `(</span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="warning"><span class="hl-todo"><span class="custom-7"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span></span></span><span class="org-block"><span class="comment">: Consider deleting this and setting the callback for repl testing directly a la set-process-filter.
</span></span><span class="org-block">    (</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> ,(intern (format </span><span class="org-block"><span class="string">"%s/sync"</span></span><span class="org-block"> repl-fun-name)) (string)
     </span><span class="org-block"><span class="doc">"Block until we see the snetiantial marker; then emit the repl output. This is an sync call to the repl."</span></span><span class="org-block">
     (thread-join (make-thread `(</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> ()
       (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="hl-todo"><span class="custom-3">DONE</span></span></span><span class="org-block"> (format </span><span class="org-block"><span class="string">"\"</span></span><span class="org-block"><span class="string"><span class="hl-todo"><span class="custom-3"><span class="hl-todo"><span class="custom-3">DONE</span></span></span></span></span></span><span class="org-block"><span class="string"> </span></span><span class="org-block"><span class="string"><span class="hl-todo"><span class="custom-2"><span class="hl-todo"><span class="custom-2">TEST</span></span></span></span></span></span><span class="org-block"><span class="string"> %s\""</span></span><span class="org-block"> (gensym)))
       </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(process-send-string jshell (format "Thread.sleep(3000)\n1 + 9\n%s\n" </span></span><span class="org-block"><span class="comment"><span class="hl-todo"><span class="custom-3"><span class="hl-todo"><span class="custom-3">DONE</span></span></span></span></span></span><span class="org-block"><span class="comment">))
</span></span><span class="org-block">       (process-send-string ,,repl (format </span><span class="org-block"><span class="string">"%s\n%s\n"</span></span><span class="org-block"> ,string </span><span class="org-block"><span class="hl-todo"><span class="custom-3">DONE</span></span></span><span class="org-block">))
       (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> my/threshold 0)
       (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> results nil)
       (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> waiting-seconds .5) </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">half a second
</span></span><span class="org-block">       (</span><span class="org-block"><span class="keyword">loop</span></span><span class="org-block">
        (sleep-for .01)
        (</span><span class="org-block"><span class="keyword">incf</span></span><span class="org-block"> my/threshold)
        (</span><span class="org-block"><span class="keyword">push</span></span><span class="org-block"> repl-driven-development-current--output results)
        (</span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> (</span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> (&lt; 1000 (* my/threshold waiting-seconds)) (s-matches? </span><span class="org-block"><span class="hl-todo"><span class="custom-3">DONE</span></span></span><span class="org-block"> repl-driven-development-current--output))
          (</span><span class="org-block"><span class="keyword">return</span></span><span class="org-block">)))
       (thread-yield)
       (cadr (-uniq results))))))

 (</span><span class="org-block"><span class="keyword">bind-key*</span></span><span class="org-block"> (s-join </span><span class="org-block"><span class="string">" "</span></span><span class="org-block"> (mapcar #'pp-to-string ,keys))
  (</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> ,repl-fun-name (region-beg region-end)
    ,(rdd---make-repl-function-docstring cmd </span><span class="org-block"><span class="string">""</span></span><span class="org-block">)
    (</span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"r"</span></span><span class="org-block">)

    (</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">pulsar</span></span><span class="org-block">)
    (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> pulsar-face 'pulsar-yellow)
    (pulsar-mode +1)
    (pulsar-pulse-line)

    (</span><span class="org-block"><span class="keyword">pcase</span></span><span class="org-block"> current-prefix-arg
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">0 &#8658; Jump to repl [</span></span><span class="org-block"><span class="warning"><span class="hl-todo"><span class="custom-7"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span></span></span><span class="org-block"><span class="comment">: Add a  keybinding for &#8220;C-u 0 C-x C-j&#8221; to return to original position.]
</span></span><span class="org-block">      (0 (switch-to-buffer (</span><span class="org-block"><span class="keyword">--&gt;</span></span><span class="org-block"> (buffer-list) (</span><span class="org-block"><span class="keyword">--map</span></span><span class="org-block"> (buffer-name it) it) (</span><span class="org-block"><span class="keyword">--filter</span></span><span class="org-block"> (s-starts-with? </span><span class="org-block"><span class="string">"*REPL/jshell"</span></span><span class="org-block"> it) it) car)))
      (-1
       </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">restart repl, [then send to repl --does not work since REPLs take a sec to load. That's OK, not a deal-breaker!]
</span></span><span class="org-block">         (kill-buffer (process-buffer ,repl))
         ,incantation-to-restart-repl)
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">('(4)  (insert " " output)) ;; C-u ;; handled when we actually have the output; see the process filter below
</span></span><span class="org-block">      ('(16) </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-u C-u &#8658; documentation lookup
</span></span><span class="org-block">       (rdd---docs-at-point (</span><span class="org-block"><span class="keyword">quote</span></span><span class="org-block"> ,docs)))
      (_
       (</span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> (use-region-p)
           (deactivate-mark)
         (beginning-of-line)
         (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> region-beg (point))
         (end-of-line)
         (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> region-end (point)))
       (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> rdd---current-input (s-trim-left (buffer-substring-no-properties region-beg region-end)))
       (process-send-string ,repl rdd---current-input)
       (process-send-string ,repl </span><span class="org-block"><span class="string">"\n"</span></span><span class="org-block">)
       ))
    )))))

(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---docs-at-point</span></span><span class="org-block"> (docs)
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Test this by writing a word such as &#8220;IntStream.range(0, 44)&#8221; then M-: (rdd---docs-at-point '("openjdk~19"))
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">anywhere on the phrase
</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">devdocs-lookup will ask to setup current docs when there's a current-prefix, so we null it.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If user does have it setup, we want to temporarily change its value for use with the current repl.
</span></span><span class="org-block">  (</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> ((devdocs-history nil) (current-prefix-arg nil) (devdocs-current-</span><span class="org-block"><span class="writegood-duplicates">docs docs</span></span><span class="org-block">) (word (</span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> (thing-at-point 'symbol) </span><span class="org-block"><span class="string">""</span></span><span class="org-block">)))
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(devdocs-lookup nil word) &#8658; Quits abruptly when keyword is not a valid candidate!
</span></span><span class="org-block">    (</span><span class="org-block"><span class="keyword">minibuffer-with-setup-hook</span></span><span class="org-block">
        `(</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> () (insert ,word))
      (call-interactively #'devdocs-lookup))))

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="warning"><span class="hl-todo"><span class="custom-7"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span></span></span><span class="org-block"><span class="comment">: Add docs about *REPL* buffer, its purpose, and alternatives
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">cl-defmethod</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---make-repl-function-docstring</span></span><span class="org-block"> ((cli string) (additional-remarks string))
  </span><span class="org-block"><span class="doc">"Makes the docstring for a repl function working with command CLI."</span></span><span class="org-block">
  (s-replace-regexp </span><span class="org-block"><span class="string">"^\s+"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block">
  (format
   </span><span class="org-block"><span class="string">"Executes the selected region, if any or otherwise the entire current line,
    and evaluates it with the command-line tool &#8220;%s&#8221;.

    Output </span></span><span class="org-block"><span class="string"><span class="writegood-passive-voice">is shown</span></span></span><span class="org-block"><span class="string"> as an overlay at the current cursor position.
    It </span></span><span class="org-block"><span class="string"><span class="writegood-passive-voice">is shown</span></span></span><span class="org-block"><span class="string"> for `</span></span><span class="org-block"><span class="string"><span class="constant">repl-driven-development/echo-duration</span></span></span><span class="org-block"><span class="string">' </span></span><span class="org-block"><span class="string"><span class="writegood-weasels">many</span></span></span><span class="org-block"><span class="string"> seconds.

    ## C-u Prefix: Insert result ###################################################

    With a &#8220;C-u&#8221; prefix, the output </span></span><span class="org-block"><span class="string"><span class="writegood-passive-voice">is inserted</span></span></span><span class="org-block"><span class="string"> at point
    (and not echoed in an overlay).

    ## C-u C-u Prefix: Documentation ##############################################

    With a &#8220;C-u C-u&#8221; prefix, documentation </span></span><span class="org-block"><span class="string"><span class="writegood-passive-voice">is looked</span></span></span><span class="org-block"><span class="string">-up for the word at point.

    This </span></span><span class="org-block"><span class="string"><span class="writegood-passive-voice">is done</span></span></span><span class="org-block"><span class="string"> using `</span></span><span class="org-block"><span class="string"><span class="constant">devdocs</span></span></span><span class="org-block"><span class="string">', and so the documentation generally provides
    example uses as well. Visit <a href="https://devdocs.io/">https://devdocs.io/</a> to see the list of documented
    languages and libraries.

    ## &#8220;C-u 0&#8221; Prefix: See associated buffer #####################################

    Sometimes it may be useful to look at a large output in a dedicated buffer.

    ## &#8220;C-u -1&#8221; Prefix: Restart REPL #############################################

    In the event you've messed-up your REPL, starting from a blank slate may be
    helpful.

    ## Implementation Notes ########################################################

    The interactive method is asynchronous: Whenever you send text for evaluation,
    you immediately regain control in Emacs; you may send more text and it will </span></span><span class="org-block"><span class="string"><span class="writegood-passive-voice">be
    queued</span></span></span><span class="org-block"><span class="string"> for evaluation. For example, evaluating a sleep command for 3 seconds
    does not block Emacs.

    ## See also ####################################################################

    See `</span></span><span class="org-block"><span class="string"><span class="constant">repl-driven-development</span></span></span><span class="org-block"><span class="string">' for more useful docs.

    See www.alhassy.com/repl-driven-development to learn more about RDD and see
    examples and </span></span><span class="org-block"><span class="string"><span class="writegood-weasels">many</span></span></span><span class="org-block"><span class="string"> gifs.
"</span></span><span class="org-block">
   cli
   )))

(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">repl-driven-development--santise-output</span></span><span class="org-block"> (output prompt input)
  </span><span class="org-block"><span class="doc">"Remove PROMPT from OUTPUT, and ensure OUTPUT does not contain a copy of INPUT."</span></span><span class="org-block">
  (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> output (s-trim (s-replace </span><span class="org-block"><span class="string">"\r"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> (s-replace-regexp prompt </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> output))))
  (</span><span class="org-block"><span class="keyword">-let</span></span><span class="org-block"> [no-input-echo (s-trim (s-chop-prefix input output))]
    (</span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> (s-blank? (s-trim (s-collapse-whitespace no-input-echo))) output no-input-echo)))

(</span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">repl-driven-development/output-hook</span></span><span class="org-block"> nil
  </span><span class="org-block"><span class="doc">"A list of functions to execute after REPL output has </span></span><span class="org-block"><span class="doc"><span class="writegood-passive-voice">been computed</span></span></span><span class="org-block"><span class="doc">.

Each function consumes a single argument: The output result, as a string.

For example:

     ;; I'd like &#8220;C-h e&#8221; to show eval result ---just as &#8220;C-x C-e&#8221; does.
     (add-hook 'repl-driven-development/output-hook
               (lambda (output)
                (let ((inhibit-message t))
                  (message \"REPL&#8658; %s\" output))
                output))
"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3">* Testing                                                        </span><span class="org-level-3"><span class="org-tag">:noexport:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Testing</span>
<span class="org-drawer">:END:</span>
<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle no
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">require</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">ert</span></span><span class="org-block">) </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Nice explanations when assertions fail.
</span></span><span class="org-block">
(</span><span class="org-block"><span class="keyword">ert-deftest</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">java</span></span><span class="org-block"> ()
  (repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"jshell"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"jshell&gt;"</span></span><span class="org-block">)
  (</span><span class="org-block"><span class="keyword">loop</span></span><span class="org-block"> with ERROR = </span><span class="org-block"><span class="string">"|  Error:"</span></span><span class="org-block">
        with NO_OUTPUT = </span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="hl-todo"><span class="custom-3"><span class="hl-todo"><span class="custom-3">DONE</span></span></span></span></span></span><span class="org-block"><span class="string"> </span></span><span class="org-block"><span class="string"><span class="hl-todo"><span class="custom-2"><span class="hl-todo"><span class="custom-2">TEST</span></span></span></span></span></span><span class="org-block"><span class="string"> g"</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">The sentianl used to mark end of tests in repl/jshell/sync
</span></span><span class="org-block">        for (input expected-output)
        in `(</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">We get a welcome message when the repl starts for the first time
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">""</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"|  Welcome to JShell -- Version 20.0.1\n|  For an introduction type: /help intro"</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">We can use a REPL like a calculator
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"1 + 2 + 3"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"6"</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Also for string arithmetic
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"\"hello\" + \" world\""</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\"hello world\""</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Also supports array arithmetic
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"IntStream.range(0, 7).toArray()"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"int[7] { 0, 1, 2, 3, 4, 5, 6 }"</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">It has memory
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"var x = 3"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"3"</span></span><span class="org-block">)
             (</span><span class="org-block"><span class="string">"2 * x"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"6"</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">It's operations are type-checked
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"2 * \"nope\""</span></span><span class="org-block"> ,ERROR)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">We can sequence expressions
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"Thread.sleep(10); 1 + 9"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"10"</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Sending nothing results in nothing
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">" \n \n \n"</span></span><span class="org-block"> ,NO_OUTPUT)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Imports result in no output
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"import java.util.stream.*"</span></span><span class="org-block"> ,NO_OUTPUT)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">We can send multi-line input
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"System\n.out\n.println\n(\"Hiya buddo!\")"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\"Hiya buddo!\""</span></span><span class="org-block">)
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><span class="hl-todo"><span class="custom-1"><span class="hl-todo"><span class="custom-1">NOTE</span></span></span></span></span></span><span class="org-block"><span class="comment">: Traditional cli repls, when consuming multi-line input, look for an empty line to indicate
</span></span><span class="org-block">             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">completition of multi-line input. As such, in the previous test, if we use \n\n anywhere instead of
</span></span><span class="org-block">             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">\n, then the multi-line input would </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">be terminated</span></span></span><span class="org-block"><span class="comment"> prematurely. This is not ideal since someone
</span></span><span class="org-block">             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">might, say, write a for-loop with extra whitespace and still want it to evaluate.
</span></span><span class="org-block">             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><span class="hl-todo"><span class="custom-7"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span></span></span><span class="org-block"><span class="comment">/IMPROVEMENT: Make our repls strip out empty newlines.
</span></span><span class="org-block">             (</span><span class="org-block"><span class="string">"System\n\n\n.out\n.println(\"Hiya buddo!\")"</span></span><span class="org-block"> ,ERROR)
             )
        do (</span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> (</span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> (equal expected-output ERROR) (s-matches? (format </span><span class="org-block"><span class="string">".*%s.*"</span></span><span class="org-block"> NO_OUTPUT) expected-output))
             (</span><span class="org-block"><span class="keyword">should</span></span><span class="org-block"> (equal expected-output (s-replace-regexp </span><span class="org-block"><span class="string">".*==&gt; "</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> (repl/jshell/sync input)))))))
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3">* Tell me something about them there Emacs threads! </span><span class="org-level-3"><span class="org-tag">:noexport:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Tell-me-something-about-them-there-Emacs-threads</span>
<span class="org-drawer">:END:</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle no
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Press C-x C-e a </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">few</span></span></span><span class="org-block"><span class="comment"> times and notice that there is no guaraentee that "Thread 2"
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is printed</span></span></span><span class="org-block"><span class="comment"> after "Thread 1"!
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
(make-thread (</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> ()
   (message (format-time-string </span><span class="org-block"><span class="string">"Thread 1 ~ %H:%M:%S"</span></span><span class="org-block"> (current-time)))
   (thread-yield)))

(make-thread (</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> ()
   (message (format-time-string </span><span class="org-block"><span class="string">"Thread 2 ~ %H:%M:%S"</span></span><span class="org-block"> (current-time)))
   (thread-yield))))

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Let's block to enforce sequencing
</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
(thread-join </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">block Emacs until this thread </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is done</span></span></span><span class="org-block"><span class="comment">!
</span></span><span class="org-block">(make-thread (</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> ()
   (message (format-time-string </span><span class="org-block"><span class="string">"Thread 1 ~ %H:%M:%S"</span></span><span class="org-block"> (current-time)))
   (thread-yield))))

(make-thread (</span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> ()
   (message (format-time-string </span><span class="org-block"><span class="string">"Thread 2 ~ %H:%M:%S"</span></span><span class="org-block"> (current-time)))
   (thread-yield))))
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+RESULTS:</span>
<span class="org-code">: #&lt;thread 0x7ffb3f1ea9d8&gt;
</span>
<span class="org-hide">**</span><span class="org-level-3">* rdd---ignore-ansi-color-codes &amp;&amp; rdd---insertion-filter</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">rdd-ignore-ansi-color-codes-rdd-insertion-filter</span>
<span class="org-drawer">:END:</span>

<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp  :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---ignore-ansi-color-codes</span></span><span class="org-block"> (string-with-codes)
  </span><span class="org-block"><span class="doc">"Ignore ANSI color codes in a string"</span></span><span class="org-block">
  (</span><span class="org-block"><span class="keyword">with-temp-buffer</span></span><span class="org-block">
    (insert string-with-codes)
    (ansi-color-apply-on-region (point-min) (point-max))
    (buffer-string)))
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+RESULTS:</span>
<span class="org-code">: repl-driven-development
</span>
<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp  :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rdd---insertion-filter</span></span><span class="org-block"> (proc string)
  </span><span class="org-block"><span class="doc">"Src: <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Filter-Functions.html">https://www.gnu.org/software/emacs/manual/html_node/elisp/Filter-Functions.html</a>"</span></span><span class="org-block">
  (</span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> (</span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> repl-driven-development--insert-into-repl-buffer (buffer-live-p (process-buffer proc)))
    (</span><span class="org-block"><span class="keyword">with-current-buffer</span></span><span class="org-block"> (process-buffer proc)
      (</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> ((moving (= (point) (process-mark proc))))
        (</span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
          (goto-char (process-mark proc))
         (</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> (buffer-read-only)(insert (rdd---ignore-ansi-color-codes string))) </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Main difference
</span></span><span class="org-block">          (set-marker (process-mark proc) (point)))
        (</span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> moving (goto-char (process-mark proc)))))))
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+RESULTS:</span>
<span class="org-code">: rdd---insertion-filter
</span>
<span class="org-meta-line">#+name: startup-code</span>
<span class="org-block-begin-line"> #+begin_src emacs-lisp  :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">repl-driven-development/echo-duration</span></span><span class="org-block"> 5)
</span><span class="org-block-end-line"> #+end_src
</span>
<span class="org-meta-line"> #+RESULTS:</span>
 <span class="org-code">: repl-driven-development/echo-duration
</span>
<span class="org-hide">*</span><span class="org-level-2">* Lisp Postamble                                                 </span><span class="org-level-2"><span class="org-tag">:noexport:</span></span>
  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Postamble</span>
  <span class="org-drawer">:END:</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp   :tangle ~/repl-driven-development/repl-driven-development.el
</span><span class="org-block"><span class="comment-delimiter">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">
(</span><span class="org-block"><span class="keyword">provide</span></span><span class="org-block"> '</span><span class="org-block"><span class="constant">repl-driven-development</span></span><span class="org-block">)

</span><span class="org-block"><span class="comment-delimiter">;;; </span></span><span class="org-block"><span class="comment">repl-driven-development.el ends here
</span></span><span class="org-block-end-line">#+END_SRC
</span><span class="org-level-1">* Teaching a runtime, </span><span class="org-level-1"><span class="bold"><a href="green:incrementally">green:incrementall</a><a href="green:incrementally">y</a></span></span><span class="org-level-1">, to be a web server &#127869;&#65039; &#128257; &#129302;</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Teaching-a-runtime-green-incrementally-to-be-a-web-server-&#65039;</span>
<span class="org-drawer">:END:</span>

<span class="org-meta-line">#+html: &lt;center&gt; &lt;em&gt;</span>
<span class="italic">RDD by example</span>: Let's start with a JavaScript runtime and incrementally turn it
into a web server.
<span class="org-meta-line">#+html: &lt;/em&gt; &lt;/center&gt;</span>

<span class="underline">&#8220;RDD &#8776; Programming as Teaching&#8221;:</span> Start from a program that already works and
&#8220;teach it&#8221; to be the program we actually want. This makes <span class="italic">programming a
goal-directed activity</span>.

Below we demonstrate this idea by starting a runtime and, like talking to a
person, we teach it new behaviours. Once it has all the desired behaviours, then
we're done and the text we've written (in our editor) is the resulting program.
Most importantly, we <span class="italic">actively interact with the running program as it evolves</span>;
where each &#8220;teaching step&#8221; <span class="writegood-passive-voice">is influenced</span> by observing the program's reactions
to <span class="writegood-weasels">various</span> stimuli (e.g., how things look, how they function, etc).

<span class="comment"># i.e., we add features to it until it becomes the program we want, moreover</span>
<span class="comment"># each feature is immediately tested since the program is live.</span>

<span class="org-hide">*</span><span class="org-level-2">* The &#8220;&#119987; as teaching&#8221; meme </span><span class="org-level-2"><span class="org-tag">:details:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">The-&#119987;-as-teaching-meme</span>
<span class="org-drawer">:END:</span>

+ The &#8220;&#119987; as teaching&#8221; meme is about <span class="italic">accomplishing the goal &#119987; as if you were
  talking to a friend in-person, explaining how to do something.</span>

+ Almost everything in programming can stand-in for &#119987;; e.g., writing a function
  or a git commit is a good way to &#8216;teach&#8217; your colleagues how to improve the
  code-base ---as such, if the function/commit does &#8220;too much&#8221; then it is a
  &#8220;poor teacher&#8221; and so not ideal.

+ Related video: <span class="org-link"><a href="https://www.youtube.com/watch?v=VEXaUHNmpQw&amp;t=1520s">&#8220;How to Write a Great Research Paper (7 </a></span><span class="org-link"><span class="writegood-weasels"><a href="https://www.youtube.com/watch?v=VEXaUHNmpQw&amp;t=1520s">Excellent</a></span></span><span class="org-link"><a href="https://www.youtube.com/watch?v=VEXaUHNmpQw&amp;t=1520s"> Tips)&#8221; by Simon Peyton Jones</a></span>.

<span class="org-hide">*</span><span class="org-level-2">* &lt;em&gt;Wait, I already do this RDD stuff everyday, in the shell!&lt;/em&gt; </span><span class="org-level-2"><span class="org-tag">:details:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">em-Wait-I-already-do-this-RDD-stuff-everyday-in-the-shell-em</span>
<span class="org-drawer">:END:</span>

You <span class="italic">can</span> <span class="bold"><a href="green:&#8220;discover&#8221;">green:&#8220;discover&#8221;</a></span> a bash script by running <span class="writegood-weasels">various</span> incantations at the
terminal, pressing the up-arrow key, tweaking your incantation ---and repeating
until you're happy with the result. In this way, you are teaching the shell a
new skill ---by repeatedly checking whether it can perform the skill and if not,
then refining your definitions.

<span class="org-meta-line">#+html: &lt;center&gt;</span>
<span class="italic">Anytime you execute a query, in </span><span class="italic"><span class="writegood-weasels">some</span></span><span class="italic"> system, you're using a read-evaluate-print-loop!</span>
<span class="org-meta-line">#+html: &lt;/center&gt;</span>

Examples include: Writing shell &amp; SQL queries, visiting web-pages by writing
URLs, exploring HTTP APIs using curl/<span class="org-link"><a href="https://httpie.io/docs/cli/json">httpie</a></span>, and using the JavaScript Console in
your browser.

<span class="org-drawer">:boring_details:</span>
Indeed, the following popular tools are either entirely
driven by a REPL or make great use of a REPL:
+ <span class="org-list-dt">SQL ::</span>
  You <span class="bold"><a href="green:&#8220;discover&#8221;">green:&#8220;discover&#8221;</a></span> the query you want, by incrementlly (1) running a number
  of queries, (2) seeing the results, then (3) tweaking the previous query;
  until you're happy with the resulting output.
  - You can &#8220;modify the running system&#8221; in this case by adding or dropping
    tables to the database.
+ <span class="org-list-dt">shell ::</span> Query &amp; modify your operating system
  - You <span class="italic">can</span> <span class="bold"><a href="green:&#8220;discover&#8221;">green:&#8220;discover&#8221;</a></span> a bash script by running <span class="writegood-weasels">various</span> incantations at
    the terminal, pressing the up-arrow key, tweaking your incantation ---and
    repeating until you're happy with the result.
+ <span class="org-list-dt">curl/</span><span class="org-link"><span class="org-list-dt"><a href="https://httpie.io/docs/cli/json">httpie</a></span></span><span class="org-list-dt"> ::</span> Explore http APIs
<span class="comment"># + <a href="https://jqlang.github.io/jq/">jq</a> :: Explor JSON blobs</span>
+ <span class="org-list-dt">JS Console in your browser ::</span> Inspect the state of objects during a running system.
+ <span class="org-list-dt">URL ::</span> The URL text area in your web browser <span class="writegood-passive-voice">is used</span> to see HTML documents
  residing on machines located elsewhere, by using The Internet infrastructure.
<span class="org-drawer">:End:</span>

<span class="bold"><a href="red:Sadly">red:Sadly</a>,</span> the <span class="italic">interface</span> to such REPLs is generally <span class="writegood-weasels">very</span> limited. There is no
syntax highlighting, no code competition, it is difficult to work with
multi-line input. This article proposes instead to use <span class="italic">your editor as the
interface to a REPL</span>: You write <span class="writegood-weasels">some</span> code in your feature-rich editor then press
<span class="writegood-weasels">some</span> keys to have <span class="italic">only the newly written code</span> executed.

<span class="org-hide">*</span><span class="org-level-2">* Actual example </span><span class="org-level-2"><span class="org-tag">:ignore:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Actual-example</span>
<span class="org-drawer">:END:</span>

<span class="comment"># Make a server, start it, then with RDD alter the request handler</span>
<span class="comment"># until we've made something we want!</span>

--------------------------------------------------------------------------------

<span class="org-table">| Goal: Make an web server with a route </span><span class="org-table"><span class="org-verbatim">localhost:3030/about</span></span><span class="org-table"> that shows information about the user's environment variables. |</span>

First,

<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">   </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-j now evaluates arbitrary JavaScript code, I'd also like docs for JS and Express
</span></span><span class="org-block">   (repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"node"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:docs</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"javascript express"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
Then, here's how we do this ...

Visit <span class="org-link"><a href="http://localhost:3030/about">http://localhost:3030/about</a></span>, if that works, then we're done!

<span class="comment"># Alternative to specifying full path:</span>
<span class="comment"># export NODE_PATH=/usr/local/lib/node_modules</span>
<span class="comment">#</span>
<span class="org-block-begin-line">#+begin_src javascript
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">First get stuff with C-x C-e:
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">(async-shell-command "npm install -g express axios@0.21.1")
</span></span><span class="org-block">
</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">app</span></span><span class="org-block"> = require(</span><span class="org-block"><span class="string">'/usr/local/lib/node_modules/express'</span></span><span class="org-block">)()
</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">server</span></span><span class="org-block"> = app.listen(3067) </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#128218; Press &#8220;C-u C-u C-x C-j&#8221; to see docs about &#8220;listen&#8221; ;-)
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Now visit <a href="http://localhost:3030/">http://localhost:3030/</a>
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">... and see &#8220;Cannot GET /&#8221;
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">... Neat, it works but it does nothing! Importantly it works!
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Let's add a route...
</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">visited</span></span><span class="org-block"> = 1
app.get(</span><span class="org-block"><span class="string">'/hi'</span></span><span class="org-block">, (req, res) =&gt; res.send(</span><span class="org-block"><span class="string">`Hello &#215; ${visited++}`</span></span><span class="org-block">))

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Now visit:  <a href="http://localhost:3030/hi">http://localhost:3030/hi</a>
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Refresh the page a </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">few</span></span></span><span class="org-block"><span class="comment"> times &#128521;
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">Excellent</span></span></span><span class="org-block"><span class="comment">; let's add an end-point to return the variables in scope
</span></span><span class="org-block">app.get(</span><span class="org-block"><span class="string">'/about'</span></span><span class="org-block">, (req, res) =&gt; res.send(html()) )

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Whoops, there's no &#8220;html&#8221;! So we see an error!
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Let's define that!
</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block">
html = _ =&gt; </span><span class="org-block"><span class="string">"&lt;div style='color:green; background-<a href="color:cyan">color:cyan</a>'&gt;"</span></span><span class="org-block"> + info() + </span><span class="org-block"><span class="string">"&lt;/div&gt;"</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Whoops, there's no &#8220;info&#8221;! So we see an error!
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Let's define that!
</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">info</span></span><span class="org-block"> = </span><span class="org-block"><span class="keyword">function</span></span><span class="org-block"> () { </span><span class="org-block"><span class="keyword">return</span></span><span class="org-block"> {visited, user: process.env.USER, time: </span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Date</span></span><span class="org-block">() } }

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Uh-oh, we see &#8220;[</span></span><span class="org-block"><span class="comment"><span class="writegood-duplicates">object Object</span></span></span><span class="org-block"><span class="comment">]&#8221; since we didn't convert the
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">JS object into a JSON string, so let's fix that!
</span></span><span class="org-block">html = _ =&gt; </span><span class="org-block"><span class="string">"&lt;div style='color:green; background-<a href="color:cyan">color:cyan</a>'&gt;"</span></span><span class="org-block"> + JSON.stringify(info(), </span><span class="org-block"><span class="constant">null</span></span><span class="org-block">, 3 </span><span class="org-block"><span class="comment-delimiter">/* </span></span><span class="org-block"><span class="comment">indentation</span></span><span class="org-block"><span class="comment-delimiter"> */</span></span><span class="org-block">) + </span><span class="org-block"><span class="string">"&lt;/div&gt;"</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">/* </span></span><span class="org-block"><span class="comment">uh-oh, the output doesn't look good; let's redefine `html` using &lt;pre&gt; tags.

   pre tells the browser engine that the content inside is pre-formatted and it can </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">be displayed</span></span></span><span class="org-block"><span class="comment"> without any modification. So browser will not remove white spaces, new lines etc. code is for making it more semantic and denotes that the content inside is a code snippet. It has nothing to with formatting.
 ,</span></span><span class="org-block"><span class="comment-delimiter">*/</span></span><span class="org-block">
html = _ =&gt; </span><span class="org-block"><span class="string">`&lt;h1&gt;Welcome, visitor ${visited++}!&lt;/h1&gt;&lt;pre style='color:green; background-<a href="color:cyan">color:cyan</a>'&gt;`</span></span><span class="org-block"> + JSON.stringify(info(), </span><span class="org-block"><span class="constant">null</span></span><span class="org-block">, 3 </span><span class="org-block"><span class="comment-delimiter">/* </span></span><span class="org-block"><span class="comment">indentation</span></span><span class="org-block"><span class="comment-delimiter"> */</span></span><span class="org-block">) + </span><span class="org-block"><span class="string">"&lt;/pre&gt;"</span></span><span class="org-block">


</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Notice how we built this end-point from the top-down: We knew what we wanted, and saw </span></span><span class="org-block"><span class="comment"><span class="writegood-weasels">some</span></span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">errors ---on the client side--- then fixed them right here, with no reloading!
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Actually, let's add more info: It's not enough to see the current user, let's see all environvment variable values
</span></span><span class="org-block">info = _ =&gt; ({user: process.env, time: </span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Date</span></span><span class="org-block">(), platform: os.platform(), architecture: os.arch(), home: os.homedir(), user: os.userInfo(), machine: os.machine()})

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">So cool!
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Eventually, consider closing the server!
</span></span><span class="org-block">server.close()
</span><span class="org-block-end-line">#+end_src
</span>
<span class="hl-todo"><span class="custom-7">TODO</span></span>: Make the above into a short youtube video/*GIF*, where I keep
&#8220;improving&#8221; the definition of <span class="org-verbatim">html</span> / <span class="org-verbatim">info</span> and see it live!
<span class="comment"># + Eg start with =html= referencing =info=, to see the &#8220;no defn error&#8221;,</span>
<span class="comment">#  then define =info=, then inline it in =html=, then keep cycling on =html=.</span>

<span class="org-block-begin-line">#+begin_box RDD is about Unobtrusive Redefining
</span><span class="org-block">Notice that our demonstration above is </span><span class="org-block"><span class="writegood-weasels"><span class="writegood-weasels">mostly</span></span></span><span class="org-block"> redefining things, making
interactive observations about them, then redefining them to be better.

Most importantly, this redefining cycle is not impeded by the need to restart
the program each time.

Instead, the already-working program &#8220;learns&#8221; what we have taught it ---and
continues to be a working program.
</span><span class="org-block-end-line">#+end_box
</span><span class="org-level-1">* Programming &#160;&#160;&#8776;&#160;&#160; Definitions and re-definitions</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Programming-Definitions-and-re-definitions</span>
<span class="org-drawer">:END:</span>

In the previous section we saw how <span class="writegood-weasels">easy</span> it was to add &amp; redefine things <span class="italic">without</span>
having to restart our program; as such we have the motto &#8220;RDD &#8776; Interactive
Programming&#8221;.
<span class="comment"># Think Agda!</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><span class="italic">In RDD, we can <a href="green:re-define">green:re-define</a> functions &amp; types live, as the program is
running! </span></span><span class="org-block"><span class="comment">@@</span></span><span class="org-block"><span class="org-tag">html:</span></span><span class="org-block"><span class="italic">&lt;br&gt;</span></span><span class="org-block"><span class="comment">@@</span></span><span class="org-block"><span class="italic"> Future uses of the function/type will use the new definition!</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_center
</span>
In stark contrast, the traditinal approach forces us to restart the whole
program whenever we make a modification, no matter how small!
That's like rebuilding your entire house when you only wanted to put up a shelf!
&#129326;

--------------------------------------------------------------------------------

<span class="org-table">| Let's explore the issue of redefinitions a bit more. |</span>
<span class="comment">#</span>
<span class="comment"># In this section, minimal working code fragments will be in Java.  Since we</span>
<span class="comment"># already have <a href="kbd:C-x_C-j">kbd:C-x_C-j</a> in this article for &#8220;J&#8221;avaScript code, let's define</span>
<span class="comment"># <a href="kbd:C-x_j">kbd:C-x_j</a> to execute &#8220;J&#8221;ava code ---using only one &#8220;C-&#8221;.</span>
<span class="comment"># #+begin_src emacs-lisp</span>
<span class="comment"># ;; Now &#8220;C-x C-g&#8221; executes Java code</span>
<span class="comment"># (repl-driven-development [C-x j] "jshell --enable-preview"</span>
<span class="comment">#                          :prompt "\njshell&gt;")</span>
<span class="comment"># #+end_src</span>

<span class="comment"># COMMENT Redefinitions in Java ---and Common Lisp</span>

If you define a function<span class="org-latex-and-related"> $f$ </span>and declare<span class="org-latex-and-related"> $x = f()$,</span> but then decide to redefine<span class="org-latex-and-related">
$f$,</span> what should happen to<span class="org-latex-and-related"> $x$?</span>  Well,<span class="org-latex-and-related"> $x$ </span>is already declared and already has a
value, so nothing happens to it!  If you want it to be the result of the
re-defined<span class="org-latex-and-related"> $f$,</span> then re-evaluate<span class="org-latex-and-related"> $x = f()$.</span> &#128077;

<span class="org-drawer">:Neato_aside:</span>
Thanks to the &#955;-Calculus, everything can be technically thought of as a function.
As such, data-types are fancy functions (Aside: In JavaScript, functions can <span class="writegood-passive-voice">be used</span>
as &#8220;classes&#8221; that <span class="writegood-passive-voice">are instantiated</span> with the &#8220;new&#8221; keyword!), and so re-defining
a data-type does not impact any existing instances: Existing instances are objects
of a class that we no longer have access to.
<span class="org-drawer">:End:</span>

<a href="orange:However">orange:However</a>, when <span class="italic">re-defining a data-type/class/record/struct</span>, languages such
as Java and Common Lisp, will insist that any previously defined instances now
conform to the new data-type formulation! Likewise, for methods whose inputs are
of the old formulation, they need to <span class="writegood-passive-voice">be updated</span> to the new one.

Take a look at this interactive Java session...
<span class="org-block-begin-line">#+begin_src java
</span><span class="org-block"><span class="type">record</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">Person</span></span><span class="org-block">(</span><span class="org-block"><span class="type">String</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">name</span></span><span class="org-block">) { }
</span><span class="org-block"><span class="type">var</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">me</span></span><span class="org-block"> = </span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Person</span></span><span class="org-block">(</span><span class="org-block"><span class="string">"Musa"</span></span><span class="org-block">); </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">New instance.
</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Can operate on it, using a functional *variable* or a *method*
</span></span><span class="org-block"><span class="type">Function</span></span><span class="org-block">&lt;</span><span class="org-block"><span class="type">Person</span></span><span class="org-block">, </span><span class="org-block"><span class="type">String</span></span><span class="org-block">&gt; </span><span class="org-block"><span class="variable-name">speak</span></span><span class="org-block"> = p -&gt; p.name() + </span><span class="org-block"><span class="string">" says HELLO!"</span></span><span class="org-block">
String greet(Person p) { </span><span class="org-block"><span class="keyword">return</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Hello, I'm "</span></span><span class="org-block"> + p.name(); }


</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Redefining our data-type
</span></span><span class="org-block"><span class="type">record</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">Person</span></span><span class="org-block">(</span><span class="org-block"><span class="type">int</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">age</span></span><span class="org-block">) { }
</span><span class="org-block"><span class="comment-delimiter">//</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658;
</span></span><span class="org-block"><span class="comment-delimiter">//  </span></span><span class="org-block"><span class="comment">record Person(int age) { }
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">|  replaced record Person
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">|    update replaced variable me which cannot </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">be referenced</span></span></span><span class="org-block"><span class="comment"> until this error </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is corrected</span></span></span><span class="org-block"><span class="comment">:
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">|      incompatible types: java.lang.String cannot </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">be converted</span></span></span><span class="org-block"><span class="comment"> to int
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">|      var me = new Person("Musa");
</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; As such, since &#8220;me&#8221; cannot </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">be updated</span></span></span><span class="org-block"><span class="comment"> to be an instance of the reformulated data-type, it </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is kicked</span></span></span><span class="org-block"><span class="comment"> out of scope!
</span></span><span class="org-block">me    </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; No such variable </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is declared</span></span></span><span class="org-block"><span class="comment">!
</span></span><span class="org-block">speak </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; No such *variable* </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is declared</span></span></span><span class="org-block"><span class="comment">!
</span></span><span class="org-block"><span class="type">greet</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; No problem, but can only run it if you define a  Person::name  instance method! &#128562;
</span></span><span class="org-block">
</span><span class="org-block"><span class="function-name">greet</span></span><span class="org-block">(</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Person</span></span><span class="org-block">(12)) </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#8658; Attempted to call method greet(Person) which cannot be
</span></span><span class="org-block">                      </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">invoked until method name() </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is declared</span></span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block-end-line">#+end_src
</span>
Whereas Java says you can no longer use stale instances, Common Lisp tries to
&#8220;re-initialise&#8221; existing instances ---and prompts the user if it cannot do so
automatically. The Common Lisp approach <span class="writegood-weasels">may have</span> benefits, but it comes at a
dangerous cost: <span class="italic">Your runtime is now no longer tied to text you've written!</span> It is
for this reason, that <span class="custom-6"><a href="melpa:repl-driven-development">melpa:repl-driven-development</a></span> intentionally does not allow
users to run code in the <span class="org-code">*REPL/&#8943;*</span> buffers: If you want to modify the running
system, write your modification down (in your working buffer, then save,) then
evaluate it.
<span class="comment"># (I.e., this is why I'm /not/ using Emacs&#8217; comint.)</span>
<span class="comment"># </span><span class="comment"><span class="hl-todo"><span class="custom-7">TODO</span></span></span><span class="comment">: Then again, I could use comint and just make them read-only. Something</span>
<span class="comment"># to think about.</span>
<span class="comment"># Then again, I've never written a real Common Lisp program. &#129335;&#8205;&#9794;&#65039; &#128579;</span>

<span class="org-level-1">* Concluding Remarks</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Concluding-Remarks</span>
<span class="org-drawer">:END:</span>
<span class="org-block-begin-line">#+begin_box </span><span class="org-block-begin-line"><span class="writegood-weasels">Some</span></span><span class="org-block-begin-line"> languages have tight integration with Emacs!
</span><span class="org-block">Programs in these languages are essentially &#8220;constructed incrementally&#8221; by
&#8220;interactive conversations&#8221; with Emacs (as the REPL).

#+begin_center
<a href="badge:Elisp|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/ElispCheatSheet/CheatSheet.pdf|Gnu-Emacs">badge:Elisp|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/ElispCheatSheet/CheatSheet.pdf|Gnu-Emacs</a>

<a href="badge:Clojure|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/ClojureCheatSheet/CheatSheet.pdf|awslambda">badge:Clojure|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/ClojureCheatSheet/CheatSheet.pdf|awslambda</a>

<a href="badge:Agda|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/AgdaCheatSheet/CheatSheet.pdf|haskell">badge:Agda|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/AgdaCheatSheet/CheatSheet.pdf|haskell</a>

<a href="badge:Coq|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/CoqCheatSheet/CheatSheet.pdf|twitter">badge:Coq|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/CoqCheatSheet/CheatSheet.pdf|twitter</a>

<a href="badge:Oz|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/OzCheatSheet/CheatSheet.pdf|pastebin">badge:Oz|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/OzCheatSheet/CheatSheet.pdf|pastebin</a>

#+end_center

The first such language is Common Lisp.
Which also inspired a similar setup for Smalltalk ---e.g., Pharo and Squeak.
</span><span class="org-block-end-line">#+end_box
</span>
I hope you've enjoyed this article!

Bye! &#128075; &#129395;

<span class="org-level-1">* Appendix: Recipes for a number of languages</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:UNNUMBERED:</span> <span class="org-property-value">t</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Appendix-Recipes-for-a-number-of-languages</span>
<span class="org-drawer">:END:</span>
<span class="org-hide">*</span><span class="org-level-2">* JavaScript ---and a minimal server             </span><span class="org-level-2"><span class="org-tag">:details_javascript:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">JavaScript-and-a-minimal-server</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:JavaScript|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/JavaScriptCheatSheet/CheatSheet.pdf|javascript">badge:JavaScript|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/JavaScriptCheatSheet/CheatSheet.pdf|javascript</a>
</span><span class="org-block-end-line">#+end_center
</span>
We can set up a JavaScript REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">   </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-j now evaluates arbitrary JavaScript code
</span></span><span class="org-block">   (repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"node -i"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
That's it! Press <span class="custom-5"><a href="kbd:C-x_C-e">kbd:C-x_C-e</a></span> on the above line so that <span class="custom-4"><a href="kbd:C-x&#160;C-j">kbd:C-x&#160;C-j</a></span> will now
evaluate a selection, or the entire line, as if it were JavaScript code.
- Why <span class="custom-4"><a href="kbd:C-x&#160;C-j">kbd:C-x&#160;C-j</a></span> &#160;?&#160; Well, <span class="custom-4"><a href="kbd:C-x_C-&#8220;e">kbd:C-x_C-&#8220;e</a></span>&#8221; for Emacs Lisp code, and <span class="custom-4"><a href="kbd:C-x_C-&#8220;j">kbd:C-x_C-&#8220;j</a></span>&#8221;
  for JavaScript code!
- For instance, copy-paste the following examples into a JavaScript file ---or just
  press <span class="custom-4"><a href="kbd:C-x&#160;C-j">kbd:C-x&#160;C-j</a></span> <span class="italic">in any buffer</span> to evaluate them!

<span class="org-block-begin-line">#+begin_src javascript
</span><span class="org-block">1 + 2                                     </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#11157; 3
</span></span><span class="org-block">
1 + </span><span class="org-block"><span class="string">'2'</span></span><span class="org-block">                                   </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#11157; '12'
</span></span><span class="org-block">
</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">me</span></span><span class="org-block"> = {name: </span><span class="org-block"><span class="string">'Jasim'</span></span><span class="org-block">}; Object.keys(me) </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#11157; ['name']
</span></span><span class="org-block">
me.doesNotExist(</span><span class="org-block"><span class="string">'whoops'</span></span><span class="org-block">)                 </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">&#11157; Uncaught TypeError
</span></span><span class="org-block-end-line">#+end_src
</span>
All of these results <span class="writegood-passive-voice">are echoed</span> inline in an overlay, by default.
Moreover, there is a <span class="bold">REPL</span> buffer created for your REPL so you
can see everything you've sent to it, and the output it sent
back.  This is particularly useful for lengthy error messages,
such as those of Java, which cannot <span class="writegood-passive-voice">be rendered</span> nicely within an
overlay.

How this works is that Emacs spawns a new &#8220;node -i&#8221; process, then
<span class="custom-5"><a href="kbd:C-x_C-j">kbd:C-x_C-j</a></span> sends text to that process. Whenever the process emits
any output ---on stdout or stderr--- then we emit that to the
user via an overlay starting with &#8220;&#11157;&#8221;.

Finally, &#8220;C-h k  C-x C-j&#8221; will show you the name of the function
that <span class="writegood-passive-voice">is invoked</span> when you press C-x C-j, along with minimal docs.

A useful example would be a minimal server, and requests for it.

<span class="org-block-begin-line">#+begin_src javascript
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">First get stuff with C-x C-e:
</span></span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">(async-shell-command "npm install -g express axios")
</span></span><span class="org-block">
</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">app</span></span><span class="org-block"> = require(</span><span class="org-block"><span class="string">'express'</span></span><span class="org-block">)()
</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">clicked</span></span><span class="org-block"> = 1
app.get(</span><span class="org-block"><span class="string">'/hi'</span></span><span class="org-block">, (req, res) =&gt; res.send(</span><span class="org-block"><span class="string">`Hello World &#215; ${clicked++}`</span></span><span class="org-block">))

</span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">server</span></span><span class="org-block"> = app.listen(3000)
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Now visit   <a href="http://localhost:3000/hi">http://localhost:3000/hi</a>   a bunch of times!
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Better yet, see the output programmatically...
</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">axios</span></span><span class="org-block"> = require(</span><span class="org-block"><span class="string">'axios'</span></span><span class="org-block">)
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Press C-x C-j a bunch of times on the following expression &#9829;&#8255;&#9829;
</span></span><span class="org-block">console.log((</span><span class="org-block"><span class="keyword">await</span></span><span class="org-block"> axios.get(</span><span class="org-block"><span class="string">'http://localhost:3000/hi'</span></span><span class="org-block">)).data)

</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Consider closing the server when you're done with it.
</span></span><span class="org-block">server.close()
</span><span class="org-block-end-line">#+end_src
</span>
<span class="comment"># (use-package plz) ;; An HTTP library for Emacs</span>
<span class="comment"># (plz 'get \"<a href="http://localhost:3000/hi">http://localhost:3000/hi</a>\")</span>

Just as &#8220;Emacs is a Lisp Machine&#8221;, one can use &#8220;VSCodeJS&#8221; to use
&#8220;VSCode as a JS Machine&#8221;.
See <span class="org-link"><a href="http://alhassy.com/vscode-is-itself-a-javascript-repl">http://alhassy.com/vscode-is-itself-a-javascript-repl</a></span>.

<span class="org-hide">*</span><span class="org-level-2">* Python </span><span class="org-level-2"><span class="org-tag">:details_python_#add8e6:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Python</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Python|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/PythonCheatSheet/CheatSheet.pdf|python">badge:Python|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/PythonCheatSheet/CheatSheet.pdf|python</a>
</span><span class="org-block-end-line">#+end_center
</span>
We can set up a Python REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-p now evaluates arbitrary Python code
</span></span><span class="org-block">    (repl-driven-development [C-x C-p] </span><span class="org-block"><span class="string">"python3 -i"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
Example use...
<span class="org-block-begin-line">#+begin_src python
</span><span class="org-block">1 </span><span class="org-block"><span class="operator">+</span></span><span class="org-block"> 2             </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#11157; 3
</span></span><span class="org-block">
</span><span class="org-block"><span class="variable-name">hello</span></span><span class="org-block"> </span><span class="org-block"><span class="operator">=</span></span><span class="org-block"> </span><span class="org-block"><span class="string">'world!'</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">(No output; this is an effectful operation)
</span></span><span class="org-block">
</span><span class="org-block"><span class="builtin">print</span></span><span class="org-block">(hello)      </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#11157; world!
</span></span><span class="org-block">
2 </span><span class="org-block"><span class="operator">+</span></span><span class="org-block"> </span><span class="org-block"><span class="string">'hi'</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#128683; TypeError: unsupported operand type(s) for +
</span></span><span class="org-block-end-line">#+end_src
</span>
Learn more by reading...  <span class="org-link"><a href="https://cs.lmu.edu/~ray/notes/pythonnetexamples/">Python: A Gentle Introduction to Socket Programming</a></span>

<span class="org-hide">*</span><span class="org-level-2">* Java                                                        </span><span class="org-level-2"><span class="org-tag">:details_java:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Java</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Java|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.com/java-cheat-sheet.pdf|coffeescript">badge:Java|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.com/java-cheat-sheet.pdf|coffeescript</a>
</span><span class="org-block-end-line">#+end_center
</span>
We can set up a Java REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">(repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"jshell --enable-preview"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"jshell&gt;"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
Now, we can select the following and press <span class="org-verbatim">C-x C-j</span> to evaluate the Java code:
<span class="org-block-begin-line">#+begin_src java :tangle no
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Ensure you're not fullscreen, and you'll see a dialog window appear.
</span></span><span class="org-block"><span class="keyword">import</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">javax</span></span><span class="org-block">.</span><span class="org-block"><span class="constant">swing</span></span><span class="org-block">.*;
JOptionPane.showMessageDialog(</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">JFrame</span></span><span class="org-block">(), </span><span class="org-block"><span class="string">"Super nice!"</span></span><span class="org-block">);
</span><span class="org-block-end-line">#+end_src
</span>
Or doing algebraic datatypes in Java:
<span class="org-block-begin-line">#+begin_src java :tangle no
</span><span class="org-block"><span class="type">sealed</span></span><span class="org-block"> </span><span class="org-block"><span class="keyword">interface</span></span><span class="org-block"> Maybe {
    </span><span class="org-block"><span class="type">record</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">None</span></span><span class="org-block">() </span><span class="org-block"><span class="keyword">implements</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Maybe</span></span><span class="org-block"> {}
    </span><span class="org-block"><span class="type">record</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">Just</span></span><span class="org-block">(</span><span class="org-block"><span class="type">int</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">x</span></span><span class="org-block">) </span><span class="org-block"><span class="keyword">implements</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Maybe</span></span><span class="org-block"> {}
}

</span><span class="org-block"><span class="type">var</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">thisPrettyPrintsNicelyInTheREPL</span></span><span class="org-block"> = </span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">Maybe</span></span><span class="org-block">.</span><span class="org-block"><span class="type">Just</span></span><span class="org-block">(3);

</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">Maybe</span></span><span class="org-block">.</span><span class="org-block"><span class="type">Just</span></span><span class="org-block">(3).equals(</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">Maybe</span></span><span class="org-block">.</span><span class="org-block"><span class="type">Just</span></span><span class="org-block">(3)) </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">yay
</span></span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2">* Clojure                            </span><span class="org-level-2"><span class="org-tag">:details_clojure:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Clojure</span>
<span class="org-drawer">:END:</span>

We can set up a REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">   </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-k now evaluates arbitrary Clojure code
</span></span><span class="org-block">   (repl-driven-development [C-x C-k] </span><span class="org-block"><span class="string">"clojure"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"user=&gt;"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
For example...
<span class="org-block-begin-line">#+begin_src clojure
</span><span class="org-block">(+ 1 2) ;; &#11157; 3

(defn square [x] (* </span><span class="org-block"><span class="writegood-duplicates">x x</span></span><span class="org-block">)) ;; &#11157; #'user/square
(square 3) ;; &#11157; 9
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2">* Haskell                                           </span><span class="org-level-2"><span class="org-tag">:details_haskell_#add8e6:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Haskell</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Haskell|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/HaskellCheatSheet/CheatSheet.pdf|awslambda">badge:Haskell|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/HaskellCheatSheet/CheatSheet.pdf|awslambda</a>
</span><span class="org-block-end-line">#+end_center
</span>
We can set up a REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">   </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-h now evaluates arbitrary Haskell code
</span></span><span class="org-block">   (repl-driven-development [C-x C-h] </span><span class="org-block"><span class="string">"ghci"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"ghci&gt;"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
For example...
<span class="org-block-begin-line">#+begin_src haskell
</span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">Sum of the first 100 squares
</span></span><span class="org-block"><span class="haskell-definition">sum</span></span><span class="org-block"> [ x </span><span class="org-block"><span class="haskell-operator">**</span></span><span class="org-block"> 2 </span><span class="org-block"><span class="haskell-operator">|</span></span><span class="org-block"> x </span><span class="org-block"><span class="haskell-operator">&lt;-</span></span><span class="org-block"> [1</span><span class="org-block"><span class="haskell-operator">..</span></span><span class="org-block">100]] </span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">&#8658; 338350.0
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">The positive evens at-most 12
</span></span><span class="org-block">[x </span><span class="org-block"><span class="haskell-operator">|</span></span><span class="org-block"> x </span><span class="org-block"><span class="haskell-operator">&lt;-</span></span><span class="org-block"> [1</span><span class="org-block"><span class="haskell-operator">..</span></span><span class="org-block">12], x </span><span class="org-block"><span class="haskell-operator">`mod`</span></span><span class="org-block"> 2 </span><span class="org-block"><span class="haskell-operator">==</span></span><span class="org-block"> 0] </span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">[2,4,6,8,10,12]
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">Define a function...
</span></span><span class="org-block"><span class="haskell-definition">myLast</span></span><span class="org-block"> </span><span class="org-block"><span class="haskell-operator">=</span></span><span class="org-block"> head </span><span class="org-block"><span class="haskell-operator">.</span></span><span class="org-block"> reverse

</span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">Then use it...
</span></span><span class="org-block"><span class="haskell-definition">myLast</span></span><span class="org-block"> [1, 2, 3] </span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">&#8658; 3
</span></span><span class="org-block-end-line">#+end_src
</span>
Note that Haskell has &#8220;typed holes&#8221; with the syntax <span class="org-verbatim">_A</span>:
<span class="org-block-begin-line">#+begin_src haskell :tangle nil
</span><span class="org-block">1 </span><span class="org-block"><span class="haskell-operator">+</span></span><span class="org-block"> _A  </span><span class="org-block"><span class="comment-delimiter">-- </span></span><span class="org-block"><span class="comment">&#8658; Found hole: _A::a; it :: forall {a}. Num a = a
</span></span><span class="org-block-end-line">#+end_src
</span>
Another language with typed holes is Arend...

<span class="org-hide">*</span><span class="org-level-2">* Arend: Quickly making a terse Emacs interface for a language without one  </span><span class="org-level-2"><span class="org-tag">:details_recipe:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Arend-Quickly-making-a-terse-Emacs-interface-for-a-language-without-one</span>
<span class="org-drawer">:END:</span>

The <span class="org-link"><a href="https://arend-lang.github.io/download#console-application">Arend Theorem Prover</a></span> has an IntelliJ interface (since it's a JetBrains proof
assistant), but no Emacs counterpart ---which may be annoying for Agda/Coq
programmers accustomed to Emacs but want to experiment with Arend.

We can set up an Arend REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-a now evaluates arbitrary Arend code
</span></span><span class="org-block">    (repl-driven-development [C-x C-a]
                             (format </span><span class="org-block"><span class="string">"java -jar %s -i"</span></span><span class="org-block">
                                     (f-expand </span><span class="org-block"><span class="string">"~/Downloads/Arend.jar"</span></span><span class="org-block">)))
</span><span class="org-block-end-line">#+end_src
</span>
Then,
<span class="org-block-begin-line">#+begin_src arend :tangle nil
</span><span class="org-block">1 Nat.+ 1 -- &#8658; 2
:type 4  -- &#8658; Fin 5

-- Declare a constant
\\func f =&gt; 1
:type f -- &#8658; Nat
f -- &#8658; 1

-- Declare a polymorphic identity function, then use it
\\func id {A : \\Type} (a : A) =&gt; a
id 12  -- &#8658; 12

-- Arend has &#8220;typed holes&#8221;
1 Nat.+ {?}  -- &#8658; Nat.+{?}: Goal: Expectedtype: Nat
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2">* PureScript  </span><span class="org-level-2"><span class="org-tag">:details_purescript_#add8e6:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">PureScript</span>
<span class="org-drawer">:END:</span>

First <span class="org-verbatim">brew install spago</span>, then we can set up a PureScript REPL in the background
as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-p now evaluates arbitrary PureScript code
</span></span><span class="org-block">    (repl-driven-development [C-x C-p] </span><span class="org-block"><span class="string">"spago repl"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
For example....
<span class="org-block-begin-line">#+begin_src purescript :tangle nil
</span><span class="org-block">import Prelude

-- Define a function
add1 = (\x -&gt; x + 1)

-- Use the function
add1 2    -- &#8658; 3

-- Experiment with a typed hole
1 + ?A  -- &#8658; Hole ?A has the inferred type Int
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2">* Idris  </span><span class="org-level-2"><span class="org-tag">:details_idris:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Idris</span>
<span class="org-drawer">:END:</span>

First <span class="org-verbatim">brew install idris2</span>, then we can set up an Idris REPL in the background as
follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-i now evaluates arbitrary Idris code
</span></span><span class="org-block">    (repl-driven-development [C-x C-i] </span><span class="org-block"><span class="string">"idris2"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
Here's <span class="writegood-weasels">some</span> random code...
<span class="org-block-begin-line">#+begin_src purescript :tangle nil
</span><span class="org-block">-- Like Lisp, Idris uses &#8220;the&#8221; for type annotations
the Nat 4  -- &#8658; 4 : Nat

with List sum [1,2,3] -- &#8658; 6

-- defining a new type (REPL specific notation)
:let data Foo : Type where Bar : Foo

:t Bar -- &#8658; Foo

-- Experiment with a typed hole [Same notation as Haskell]
1 + ?A -- prim__add_Integer 1 ?A
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2">* Racket  </span><span class="org-level-2"><span class="org-tag">:details_racket_#add8e6:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Racket</span>
<span class="org-drawer">:END:</span>

<span class="org-table">| Racket is a modern programming language in the Lisp/Scheme family. |</span>

First <span class="org-verbatim">brew install --cask racket</span>, then we can set up an Racket REPL in the
background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-i now evaluates arbitrary Racket code
</span></span><span class="org-block">    (repl-driven-development [C-x C-r] </span><span class="org-block"><span class="string">"racket -I slideshow"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
Here's <span class="writegood-weasels">some</span> random code...
<span class="org-block-begin-line">#+begin_src racket :tangle nil
</span><span class="org-block">(define (series mk) (hc-append 4 (mk 5) (mk 10) (mk 20)))

;; Shows 3 circles of increasing radius, in an external window
(show-pict (series circle))
</span><span class="org-block-end-line">#+end_src
</span>
Meeting Racket for the first time is <span class="writegood-weasels">probably</span> best done with <span class="italic">DrRacket</span>.
<span class="comment"># - Learning it can </span><span class="comment"><span class="writegood-passive-voice">be done</span></span><span class="comment"> with a nice Emacs-integrated REPL ---see <a href="https://beautifulracket.com/">Beautiful Racket by Matthew Butterick</a>.</span>

<span class="org-hide">*</span><span class="org-level-2">* </span><span class="org-level-2"><span class="org-todo"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span><span class="org-level-2"> </span><span class="org-special-keyword">COMMENT</span><span class="org-level-2"> Prolog ---saving the REPL for future use         </span><span class="org-level-2"><span class="org-tag">:not_ideal_use_case:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-Prolog-saving-the-REPL-for-future-use</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Prolog|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/PrologCheatSheet/CheatSheet.pdf|prolog">badge:Prolog|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/PrologCheatSheet/CheatSheet.pdf|prolog</a>
</span><span class="org-block-end-line">#+end_center
</span>
First get the Prolog interpreter with <span class="org-verbatim">brew install swi-prolog</span>, then we can set
up an Racket REPL in the background as follows...

<span class="org-block-begin-line">#+begin_src elisp
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-p now evaluates arbitrary Prolog code
</span></span><span class="org-block">    (</span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> prolog (repl-driven-development [C-x C-p] </span><span class="org-block"><span class="string">"swipl"</span></span><span class="org-block">))
</span><span class="org-block-end-line">#+end_src
</span>
Notice that we saved the <span class="custom-button"><a href="doc:prolog">doc:prolog</a></span> variable... &#129302;
- This <span class="writegood-passive-voice">is done</span> since Prolog is &#8220;modal&#8221;: One <span class="italic">declares</span> facts, then <span class="italic">queries</span> them.
- To avoid a query accidentally <span class="writegood-passive-voice">being considered</span> a delaraction of a true fact,
  we use <span class="org-verbatim">[user].</span> to begin declaring facts, then invoke :<span class="custom-button"><a href="doc:process-send-eof">doc:process-send-eof</a></span> to
  the Prolog REPL to begin querying our database.

<span class="org-drawer">:Idea_To_improve_RDD_el:</span>
<span class="org-block-begin-line">#+begin_src elisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="warning"><span class="hl-todo"><span class="custom-7"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span></span></span><span class="org-block"><span class="comment">: Let repl-driven-development take param :before, which is a function that looks at the input and decides what to do with it; e.g., by sending something specific to the process. Use case: If it sees &#8220;%\s*begin facts&#8221; then it sends &#8220;[user].&#8221; and echos &#8220;Now declaring facts, evaluate &#8220;% end facts&#8221; to begin querying your fact database.&#8221; Likewise &#8220;%\s* end facts&#8221; evaluates (process-send-eof prolog).
</span></span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Add another param :after, that does subsequent processing after a region </span></span><span class="org-block"><span class="comment"><span class="writegood-passive-voice">is sent</span></span></span><span class="org-block"><span class="comment"> to the repl.
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">USE CASE: In prolog, we repeatedly send &#8220;;&#8221; until we get empty feedback, and upon each send we move the curosr down so that the results are all on different lines. This is a way to see all possible solutions in prolog, with the saftey net of 30 &#8220;;&#8221; sent! (e.g., in case the user evaluates a massive predicate!)
</span></span><span class="org-block-end-line">#+end_src
</span><span class="org-drawer">:End:</span>

First, let's declare <span class="writegood-weasels">some</span> facts.
<span class="org-block-begin-line">#+begin_src prolog
</span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">See: <a href="https://www.swi-prolog.org/FAQ/ToplevelMode.html">https://www.swi-prolog.org/FAQ/ToplevelMode.html</a>
</span></span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">and: <a href="https://stackoverflow.com/questions/4084427/how-to-create-a-fact-in-swi-prolog">https://stackoverflow.com/</a></span></span><span class="org-block"><span class="comment"><span class="function-name"><a href="https://stackoverflow.com/questions/4084427/how-to-create-a-fact-in-swi-prolog">questions/4084427</a></span></span></span><span class="org-block"><span class="comment"><a href="https://stackoverflow.com/questions/4084427/how-to-create-a-fact-in-swi-prolog">/how-to-create-a-fact-in-swi-prolog</a>
</span></span><span class="org-block"><span class="keyword">[</span></span><span class="org-block">user</span><span class="org-block"><span class="keyword">]</span></span><span class="org-block">.
</span><span class="org-block"><span class="function-name">parent</span></span><span class="org-block">(musa, yusuf).
</span><span class="org-block"><span class="function-name">parent</span></span><span class="org-block">(musa, zaynab).
</span><span class="org-block"><span class="function-name">parent</span></span><span class="org-block">(malak, yusuf).
</span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">(process-send-eof prolog) ;; C-x C-e to finish declarations
</span></span><span class="org-block-end-line">#+end_src
</span>
Now, we can continue using <span class="custom-4"><a href="kbd:C-x&#160;C-p">kbd:C-x&#160;C-p</a></span> to query facts.
<span class="org-block-begin-line">#+begin_src prolog
</span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">Who are the parents of yusuf?
</span></span><span class="org-block"><span class="function-name">parent</span></span><span class="org-block">(</span><span class="org-block"><span class="variable-name">X</span></span><span class="org-block">, yusuf).
</span><span class="org-block"><span class="keyword">;</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">This shows more solutions: Press C-x C-p to see them!
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">Who are the children of musa?
</span></span><span class="org-block"><span class="function-name">parent</span></span><span class="org-block">(musa, </span><span class="org-block"><span class="variable-name">X</span></span><span class="org-block">).

</span><span class="org-block"><span class="comment-delimiter">% </span></span><span class="org-block"><span class="comment">Actually see all solutions
</span></span><span class="org-block"><span class="function-name">findall</span></span><span class="org-block">(</span><span class="org-block"><span class="variable-name">X</span></span><span class="org-block">, parent(musa, </span><span class="org-block"><span class="variable-name">X</span></span><span class="org-block">), </span><span class="org-block"><span class="variable-name">Xs</span></span><span class="org-block">).
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">*</span><span class="org-level-2">* </span><span class="org-level-2"><span class="org-todo"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span><span class="org-level-2"> </span><span class="org-special-keyword">COMMENT</span><span class="org-level-2"> Ruby</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-Ruby</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Ruby|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/RubyCheatSheet/CheatSheet.pdf|ruby">badge:Ruby|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/RubyCheatSheet/CheatSheet.pdf|ruby</a>
</span><span class="org-block-end-line">#+end_center
</span>
We can set up a REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">   </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-r now evaluates arbitrary Ruby code
</span></span><span class="org-block">   (repl-driven-development [C-x C-r] </span><span class="org-block"><span class="string">"irb --inf-ruby-mode"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"irb(main):.*&gt;"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
For example...
<span class="org-block-begin-line">#+begin_src ruby
</span><span class="org-block">2 + 2

33 + 4

5.times { </span><span class="org-block"><span class="builtin">print</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Odelay!"</span></span><span class="org-block"> } </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#11157; Odelay! Odelay! Odelay! Odelay! Odelay! 5
</span></span><span class="org-block">
[</span><span class="org-block"><span class="string">'ruby'</span></span><span class="org-block">, </span><span class="org-block"><span class="string">'is'</span></span><span class="org-block">, </span><span class="org-block"><span class="string">'readable'</span></span><span class="org-block">].map { | food | food.capitalize } </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">&#11157; ["Ruby", "Is", "Readable"]
</span></span><span class="org-block">
</span><span class="org-block"><span class="builtin">require</span></span><span class="org-block"> </span><span class="org-block"><span class="string">'tk'</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">*</span><span class="org-level-2">* </span><span class="org-level-2"><span class="org-todo"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span><span class="org-level-2"> </span><span class="org-special-keyword">COMMENT</span><span class="org-level-2"> TypeScript</span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-TypeScript</span>
<span class="org-drawer">:END:</span>

We can set up a REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">   </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-j now evaluates arbitrary JavaScript code
</span></span><span class="org-block">   (repl-driven-development [C-x C-t] </span><span class="org-block"><span class="string">"npx ts-node"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2">* </span><span class="org-special-keyword">COMMENT</span><span class="org-level-2"> F#          </span><span class="org-level-2"><span class="org-tag">:Does_not_work:fsharpi_requires_ansi_term__not_eshell:</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-F</span>
<span class="org-drawer">:END:</span>

<a href="badge:F#|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/FSharpCheatSheet/CheatSheet.pdf|f-sharp">badge:F#|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/FSharpCheatSheet/CheatSheet.pdf|f-sharp</a>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:OCaml|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/OCamlCheatSheet/CheatSheet.pdf|OCaml">badge:OCaml|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.github.io/OCamlCheatSheet/CheatSheet.pdf|OCaml</a>
</span><span class="org-block-end-line">#+end_center
</span>
First <span class="org-verbatim">brew install mono</span>, then we can set up an F# REPL in the background as
follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp :tangle nil
</span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">C-x C-j now evaluates arbitrary F#Script code
</span></span><span class="org-block">    (repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"fsharpi"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-block-begin-line">#+begin_src fsharp :tangle nil
</span><span class="org-block">-- F# has &#8220;ranges with a step&#8221;
[0..3..14];;     -- &#8658; [0; 3; 6; 9]

-- Which are a shorthand for guarded comprehensions
[for i in 0..14 do if i % 3 = 0 then yield i];;

-- Experiment with a typed hole
1 + __;;   -- &#8658; The type 'obj' does not match the type 'int'
</span><span class="org-block-end-line">#+end_src
</span>
If you like F#, take a look at <span class="org-link"><a href="https://fstar-lang.org/">F*: A Proof-Oriented Programming Language</a></span>.

<span class="org-hide">*</span><span class="org-level-2">* </span><span class="org-level-2"><span class="org-todo"><span class="hl-todo"><span class="custom-7">TODO</span></span></span></span><span class="org-level-2"> </span><span class="org-special-keyword">COMMENT</span><span class="org-level-2"> Java </span><span class="org-level-2"><span class="flyspell-duplicate">MWE</span></span>
<span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-Java-MWE</span>
<span class="org-drawer">:END:</span>

<span class="org-block-begin-line">#+begin_center
</span><span class="org-block"><a href="badge:Java|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.com/java-cheat-sheet.pdf|coffeescript">badge:Java|Colourful&#160;PDF&#160;CheatSheet|success|https://alhassy.com/java-cheat-sheet.pdf|coffeescript</a>
</span><span class="org-block-end-line">#+end_center
</span>
We can set up a Java REPL in the background as follows...
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">(repl-driven-development [C-x C-j] </span><span class="org-block"><span class="string">"jshell --enable-preview"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:prompt</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"jshell&gt;"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+end_src
</span>
Now, we can select the following and press <span class="org-verbatim">C-x C-j</span> to evaluate the Java code:
<span class="org-block-begin-line">#+begin_src java :tangle no
</span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">Ensure you're not fullscreen, and you'll see a dialog window appear.
</span></span><span class="org-block"><span class="keyword">import</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">javax</span></span><span class="org-block">.</span><span class="org-block"><span class="constant">swing</span></span><span class="org-block">.*;
JOptionPane.showMessageDialog(</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="type">JFrame</span></span><span class="org-block">(), </span><span class="org-block"><span class="string">"Super nice!"</span></span><span class="org-block">);
</span><span class="org-block-end-line">#+end_src
</span>
Or doing algebraic datatypes in Java:
<span class="org-block-begin-line">#+begin_src java :tangle no
</span><span class="org-block"><span class="type">sealed</span></span><span class="org-block"> </span><span class="org-block"><span class="keyword">interface</span></span><span class="org-block"> Maybe {
    </span><span class="org-block"><span class="type">record</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">None</span></span><span class="org-block">() </span><span class="org-block"><span class="keyword">implements</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Maybe</span></span><span class="org-block"> {}
    </span><span class="org-block"><span class="type">record</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">Just</span></span><span class="org-block">(</span><span class="org-block"><span class="type">int</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">x</span></span><span class="org-block">) </span><span class="org-block"><span class="keyword">implements</span></span><span class="org-block"> </span><span class="org-block"><span class="type">Maybe</span></span><span class="org-block"> {}
}

</span><span class="org-block"><span class="type">var</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">thisPrettyPrintsNicelyInTheREPL</span></span><span class="org-block"> = </span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">Maybe</span></span><span class="org-block">.</span><span class="org-block"><span class="type">Just</span></span><span class="org-block">(3);

</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">Maybe</span></span><span class="org-block">.</span><span class="org-block"><span class="type">Just</span></span><span class="org-block">(3).equals(</span><span class="org-block"><span class="keyword">new</span></span><span class="org-block"> </span><span class="org-block"><span class="constant">Maybe</span></span><span class="org-block">.</span><span class="org-block"><span class="type">Just</span></span><span class="org-block">(3)) </span><span class="org-block"><span class="comment-delimiter">// </span></span><span class="org-block"><span class="comment">yay
</span></span><span class="org-block-end-line">#+end_src
</span>
<span class="org-level-1">* </span><span class="org-special-keyword">COMMENT</span><span class="org-level-1"> MELPA Checks</span>
  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-MELPA-Checks</span>
  <span class="org-drawer">:END:</span>
<span class="org-link"><a href="https://github.com/riscy/melpazoid">https://github.com/riscy/melpazoid</a></span>

1. In Github repo: Add file &#8658; Create new file &#8658; License.txt &#8658; Select template &#8658; GNU 3
2. Ensure first line ends with: -<span class="bold">- lexical-binding: t; -</span>-
3. Include appropriate standard keywords;
<span class="org-block-begin-line">   #+begin_src emacs-lisp :tangle no
</span><span class="org-block">(pp finder-known-keywords)
</span><span class="org-block-end-line">   #+end_src
</span>
<span class="org-meta-line">   #+RESULTS:</span>
<span class="org-block-begin-line">   #+begin_example
</span><span class="custom">   ((abbrev . "abbreviation handling, typing shortcuts, and macros")
    (bib . "bibliography processors")
    (c . "C and related programming languages")
    (calendar . "calendar and time management tools")
    (comm . "communications, networking, and remote file access")
    (convenience . "convenience features for faster editing")
    (data . "editing data (non-text) files")
    (docs . "Emacs documentation facilities")
    (emulations . "emulations of other editors")
    (extensions . "Emacs Lisp language extensions")
    (faces . "fonts and colors for text")
    (files . "file editing and manipulation")
    (frames . "Emacs frames and window systems")
    (games . "games, jokes and amusements")
    (hardware . "interfacing with system hardware")
    (help . "Emacs help systems")
    (hypermedia . "links between text or other media types")
    (i18n . "internationalization and character-set support")
    (internal . "code for Emacs internals, build process, defaults")
    (languages . "specialized modes for editing programming languages")
    (lisp . "Lisp support, including Emacs Lisp")
    (local . "code local to your site")
    (maint . "Emacs development tools and aids")
    (mail . "email reading and posting")
    (matching . "searching, matching, and sorting")
    (mouse . "mouse support")
    (multimedia . "images and sound")
    (news . "USENET news reading and posting")
    (outlines . "hierarchical outlining and note taking")
    (processes . "processes, subshells, and compilation")
    (terminals . "text terminals (ttys)")
    (tex . "the TeX document formatter")
    (tools . "programming tools")
    (unix . "UNIX feature interfaces and emulators")
    (vc . "version control")
    (wp . "word processing"))
</span><span class="org-block-end-line">   #+end_example
</span>4. Use #' instead of ' for function symbols
5. Use &#8216;-&#8217; as a separator, not &#8216;/&#8217;.
6. Consider reading:
   <span class="org-link"><a href="https://github.com/bbatsov/emacs-lisp-style-guide#the-emacs-lisp-style-guide">https://github.com/bbatsov/emacs-lisp-style-guide#the-emacs-lisp-style-guide</a></span>
7. Use cl-loop, cl-first, cl-second, cl-third instead of loop, first, second, third
8. byte-compile and address any concerns
9. <span class="org-verbatim">M-x checkdoc</span> on the lisp file to ensure it passes expected style issues.
   - Symbols <span class="org-verbatim">nil, t</span> should not appear in single quotes.
   - (progn (setq fill-column 80) (display-fill-column-indicator-mode))
10. Ensure it byte-compiles without any problems.
11. Ensure that package-linter raises no issues; i.e., the following has no result.
<span class="org-block-begin-line">     #+BEGIN_SRC emacs-lisp :tangle no
</span><span class="org-block"> (</span><span class="org-block"><span class="keyword">use-</span></span><span class="org-block"><span class="keyword"><span class="writegood-duplicates">package</span></span></span><span class="org-block"><span class="writegood-duplicates"> </span></span><span class="org-block"><span class="constant"><span class="writegood-duplicates">package</span></span></span><span class="org-block"><span class="constant">-lint</span></span><span class="org-block">)
 (</span><span class="org-block"><span class="keyword">-let</span></span><span class="org-block"> [it </span><span class="org-block"><span class="string">"repl-driven-development.el"</span></span><span class="org-block">]
  (</span><span class="org-block"><span class="keyword">ignore-errors</span></span><span class="org-block"> (kill-buffer it))
  (find-file-other-window it)
  (package-lint-buffer it)
  (switch-to-buffer </span><span class="org-block"><span class="string">"*Package-Lint*"</span></span><span class="org-block">)) </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Should say: &#8220;No issues found.&#8221;
</span></span><span class="org-block-end-line"> #+END_SRC
</span>12. Commit and push everything in your project's repo!
13. Create a recipe file by invoking: M-x package-build-create-recipe
    ---first: (use-<span class="writegood-duplicates">package package</span>-build)
    - Place it in: melpa/recipes/
    - The name of the file should be the name of the package, no extension.

    <span class="bold">Or:</span> Uncomment this section &amp; just tangle the following.
<span class="org-block-begin-line">           #+BEGIN_SRC emacs-lisp :tangle ~/melpa/recipes/repl-driven-development
</span><span class="org-block">    (repl-driven-development </span><span class="org-block"><span class="builtin">:fetcher</span></span><span class="org-block"> github </span><span class="org-block"><span class="builtin">:repo</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"alhassy/repl-driven-development"</span></span><span class="org-block">)
</span><span class="org-block-end-line">        #+END_SRC
</span>14. Ensure the recipe builds successfully:
<span class="org-block-begin-line">    #+BEGIN_SRC shell :tangle no
</span><span class="org-block">    </span><span class="org-block"><span class="builtin">cd</span></span><span class="org-block"> ~/melpa; rm ~/melpa/packages/repl-driven-development-*; make recipes/repl-driven-development
</span><span class="org-block-end-line">    #+END_SRC
</span>
    If you have trouble, make a file "~/bin/emacs" with
    the following which ensures &#8220;emacs&#8221; can <span class="writegood-passive-voice">be run</span>
    from the command line within macos.
<span class="org-block-begin-line">    #+begin_src shell :tangle "~/bin/emacs"
</span><span class="org-block"><span class="comment-delimiter">#</span></span><span class="org-block"><span class="comment">!/bin/sh
</span></span><span class="org-block">/Applications/Emacs.app/Contents/MacOS/Emacs </span><span class="org-block"><span class="string">"$@"</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
15. Ensure the package installs properly from within Emacs:

<span class="org-block-begin-line">      #+BEGIN_SRC emacs-lisp :tangle no
</span><span class="org-block">(package-install-file </span><span class="org-block"><span class="string">"~/melpa/packages/repl-driven-development-"</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+END_SRC
</span>
16. Produce a dedicated pull request branch

<span class="org-block-begin-line">    #+begin_src emacs-lisp :tangle no
</span><span class="org-block">    (magit-status </span><span class="org-block"><span class="string">"~/melpa"</span></span><span class="org-block">)
</span><span class="org-block-end-line">    #+end_src
</span>
    + <span class="org-code">F p</span> to update the repo.
    + Now <span class="org-verbatim">b c</span> to checkout a new branch: Select <span class="org-code">master</span> then name the branch by
      the name of the package, e.g., <span class="org-code">repl-driven-development</span>.
    + Commit your recipe.
    + Push this branch on your melpa fork: <span class="org-code"><span class="writegood-duplicates">P p</span></span>.
    + Go to the <span class="org-link"><a href="https://github.com/melpa/melpa">https://github.com/melpa/melpa</a></span> repo and
      there'll be a big green PR button ^_^
<span class="org-level-1">* </span><span class="org-special-keyword">COMMENT</span><span class="org-level-1"> Making </span><span class="org-level-1"><span class="org-code">README.org</span></span>
  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">COMMENT-Making-README-org</span>
  <span class="org-drawer">:END:</span>

  Evaluate the following source block with <span class="org-code">C-</span><span class="org-code"><span class="writegood-duplicates">c C</span></span><span class="org-code">-c</span> to produce a <span class="org-code">README</span> file.

<span class="org-meta-line">#+NAME: make-readme</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">(</span><span class="org-block"><span class="keyword">with-temp-buffer</span></span><span class="org-block">

,#+EXPORT_FILE_NAME: README.md
,#+HTML: &lt;h1&gt; An Emacs interface to the Quran and the Bible: Interactive lookup, Org-mode links, tooltips, and Lisp look-ups &lt;/h1&gt;
# +HTML: &lt;h2&gt;  &#175;\\_(&#12484;)_/&#175;  &lt;/h2&gt;
,#+OPTIONS: toc:nil d:nil broken-links:t
,#+html: &lt;div align=\"center\"&gt;
#   +INCLUDE: ~/repl-driven-development/repl-driven-development.org::#Abstract </span><span class="org-block"><span class="builtin">:only-contents</span></span><span class="org-block"> t
,#+html: &lt;/div&gt;

,#+html: &lt;div align=\"center\"&gt;
Let's use Org-mode links to look-up Quranic and Biblical verses!

</span><span class="org-block"><span class="warning">&#8220;</span></span><span class="org-block">Live</span><span class="org-block"><span class="warning">&#8221;</span></span><span class="org-block"> examples &amp; documentation: <a href="https://alhassy.github.io/repl-driven-development/">https://alhassy.github.io/repl-driven-development/</a>

<a href="badge:repl-driven-development|1.3|informational|https://github.com/alhassy/repl-driven-development|Gnu-Emacs">badge:repl-driven-development|1.3|informational|https://github.com/alhassy/repl-driven-development|Gnu-Emacs</a>

# #+html: &lt;a href=\"<a href="https://melpa.org/#/repl-driven-development">https://melpa.org/#/repl-driven-development</a>\"&gt;&lt;img alt=\"MELPA\" src=\"<a href="https://melpa.org/packages/repl-driven-development-badge.svg\&quot;/">https://melpa.org/packages/repl-driven-development-badge.svg\"/</a>&gt;&lt;/a&gt;
# #+html: &lt;/span&gt;

<a href="tweet:https://github.com/alhassy/repl-driven-development">tweet:https://github.com/alhassy/repl-driven-development</a>
<a href="badge:contributions|welcome|green|https://github.com/alhassy/repl-driven-development/issues">badge:contributions|welcome|green|https://github.com/alhassy/repl-driven-development/issues</a>

<a href="badge:author|musa_al-hassy|purple|https://alhassy.github.io/|nintendo-3ds">badge:author|musa_al-hassy|purple|https://alhassy.github.io/|nintendo-3ds</a>
<a href="badge:|buy_me_a&#160;coffee|gray|https://www.buymeacoffee.com/alhassy|buy-me-a-coffee">badge:|buy_me_a&#160;coffee|gray|https://www.buymeacoffee.com/alhassy|buy-me-a-coffee</a>

<a href="badge:Hire|me|success|https://alhassy.github.io/about">badge:Hire|me|success|https://alhassy.github.io/about</a>

,#+html: &lt;/div&gt;

,#+TOC: headlines 2

,* Short Example
,#+attr_html: </span><span class="org-block"><span class="builtin">:width</span></span><span class="org-block"> 600px
<a href="file:images/short_example.png">file:images/short_example.png</a>

,* Long Example
,#+attr_html: </span><span class="org-block"><span class="builtin">:width</span></span><span class="org-block"> 600px
<a href="file:images/long_example.png">file:images/long_example.png</a>

,* Summary
,#+INCLUDE: ~/repl-driven-development/repl-driven-development.org::#Summary </span><span class="org-block"><span class="builtin">:only-contents</span></span><span class="org-block"> t
#  ,* Minimal working example
#  #+INCLUDE: ~/repl-driven-development/repl-driven-development.org::#Minimal-working-example </span><span class="org-block"><span class="builtin">:only-contents</span></span><span class="org-block"> t
")
    (let ((org-export-use-babel nil) (org-export-with-broken-links t))
      (org-mode)
      (org-md-export-to-markdown)))
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-meta-line">#+RESULTS: make-readme</span>
<span class="org-code">: README.md
</span>
<span class="bold">Then</span> use <span class="org-verbatim">grip</span> to see that this looks reasonable.
</pre>
  </body>
</html>
